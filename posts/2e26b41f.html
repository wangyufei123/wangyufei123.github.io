<!DOCTYPE html>
<html lang=zh>
<head>
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="renderer" content="webkit">
  <meta http-equiv="Cache-Control" content="no-transform" />
  <meta http-equiv="Cache-Control" content="no-siteapp" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="format-detection" content="telephone=no,email=no,adress=no">
  <!-- Color theme for statusbar -->
  <meta name="theme-color" content="#000000" />
  <!-- 强制页面在当前窗口以独立页面显示,防止别人在框架里调用页面 -->
  <meta http-equiv="window-target" content="_top" />
  
  
  <title>Spring_Cloud笔记一 | 随笔小记</title>
  <meta name="description" content="SpringCloud微服务1. 微服务架构编码构建1.1 IDEA新建project工作空间创建父工程步骤:  微服务cloud整体聚合父工程Project  NewProject  聚合总工程名字:cloud2020  Maven选版本:3.6.3  工程名字****  字符编码  注解生效激活  java编译版本选jdk1.8  File Type过滤填入的代码块：   1*.hprof;*">
<meta property="og:type" content="article">
<meta property="og:title" content="Spring_Cloud笔记一">
<meta property="og:url" content="http://lwblog.xyz/posts/2e26b41f.html">
<meta property="og:site_name" content="随笔小记">
<meta property="og:description" content="SpringCloud微服务1. 微服务架构编码构建1.1 IDEA新建project工作空间创建父工程步骤:  微服务cloud整体聚合父工程Project  NewProject  聚合总工程名字:cloud2020  Maven选版本:3.6.3  工程名字****  字符编码  注解生效激活  java编译版本选jdk1.8  File Type过滤填入的代码块：   1*.hprof;*">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/007S8ZIlly1ghrsexqhlnj31lq0m646d.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/007S8ZIlly1ghrsumj5jxj314h0u0gv4.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/007S8ZIlly1ghrswv04h1j31hy0oqjz7.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/007S8ZIlly1ghrsy39tbij31hy0jgdkt.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/007S8ZIlly1ghrt1bozpmj31470u0aim.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/007S8ZIlly1ghru63tkvyj30qm0so1kx.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/007S8ZIlly1ghrufr0a73j31b20u0n7f.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/007S8ZIlly1ghsqe7i9egj314b0u0n5w.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/007S8ZIlgy1ghsqkdotlwj30nc08mae8.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/007S8ZIlly1ghsqlsjiadj31d80te79m.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/007S8ZIlly1ghtrn44cudj31b90gngtz.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/007S8ZIlly1ghtsvv46ukj31cp0u0guw.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/007S8ZIlly1ghttlxh4fwj31ft0u0qce.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/007S8ZIlly1ghttmktrtcj316q0lo7kj.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/007S8ZIlly1ghtu58jt0rj31c70u0dqi.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/007S8ZIlly1ghtuonapuxj31da0fan8m.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/007S8ZIlly1ghtusj1w51j30k80a4t9f.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/007S8ZIlly1ghtx03t8v2j31ji0kukjl.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/007S8ZIlly1ghu3xu9igpj31je0qc1ky.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/007S8ZIlly1ghu41i0w8gj31ok0qm7wi.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/007S8ZIlly1ghu4act4d8j31jf0u0wmb.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/007S8ZIlly1ghu4fqizzkj31ne0p01ky.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/007S8ZIlly1ghu4ik12bxj31qo0u0aif.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/007S8ZIlly1ghuvpxtwcaj31ew0ianea.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/007S8ZIlly1ghuvxf920dj30vu0hkh1b.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/007S8ZIlly1ghuy88tgopj318o0iyb29.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/007S8ZIlly1ghuy8sj2ooj31mw0nsx6p.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/007S8ZIlly1ghv9w26r5jj31ei0f0wqm.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/007S8ZIlly1ghvw7x5oo0j31fz0u0qba.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/007S8ZIlly1ghvx3gkg37j30mv07qtcq.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/007S8ZIlly1ghvx2ezkkmj30pw0jbgrb.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/007S8ZIlly1ghwd6wnewvj31680k2k4t.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/007S8ZIlly1ghx0jo4qjfj31ii0k6hdt.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/007S8ZIlly1ghx1mdw1bpj315q0hu165.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/007S8ZIlly1ghx3ke4l7aj318y0bcdw0.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/007S8ZIlly1ghx57vtvwwj317u0pcnpd.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/007S8ZIlly1ghx59t9ee8j319i0ia4gu.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/007S8ZIlly1ghx9rjcybnj31580k47wh.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/007S8ZIlly1ghx9ry0vavj30wg084k13.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/007S8ZIlly1ghx8tpp26fj31bb0u0tl6.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/007S8ZIlly1ghy8j2pqjej31xr0u01kz.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/007S8ZIlly1ghy9coq979j319o0jye81.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/007S8ZIlly1ghy9d5z0vmj31e20nqqv5.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/007S8ZIlly1ghy9ec2kokj31ok0pg7wi.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/007S8ZIlly1ghy9mfyh6jj318m0k2qfa.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/007S8ZIlly1ghy9xa99clj31fw0u0b2c.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/007S8ZIlly1gib5z5mab2j315z0u07wj.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/007S8ZIlly1gib6j3wn7cj31ey0osdzr.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/007S8ZIlly1gib6pq9zqfj30n60ey43r.jpg">
<meta property="article:published_time" content="2020-09-05T04:47:11.000Z">
<meta property="article:modified_time" content="2020-09-05T06:47:27.933Z">
<meta property="article:author" content="Mr.Wang">
<meta property="article:tag" content="java 前端">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://tva1.sinaimg.cn/large/007S8ZIlly1ghrsexqhlnj31lq0m646d.jpg">
  <!-- Canonical links -->
  <link rel="canonical" href="http://lwblog.xyz/posts/2e26b41f.html">
  
    <link rel="alternate" href="/atom.xml" title="随笔小记" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
  
  
<link rel="stylesheet" href="/css/style.css">

  
  
  
    <link href="//cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.3.5/dist/jquery.fancybox.min.css" rel="stylesheet">
  
  
<meta name="generator" content="Hexo 4.2.0"></head>


<body class="main-center theme-black" itemscope itemtype="http://schema.org/WebPage">
  <header class="header" itemscope itemtype="http://schema.org/WPHeader">
  <div class="slimContent">
    <div class="navbar-header">
      
      
      <div class="profile-block text-center">
        <a id="avatar" href="https://github.com/wangyufei123" target="_blank">
          <img class="img-circle img-rotate" src="/images/avatar.jpeg" width="200" height="200">
        </a>
        <h2 id="name" class="hidden-xs hidden-sm">Mr.Wang</h2>
        <h3 id="title" class="hidden-xs hidden-sm hidden-md">Web Developer &amp; Designer</h3>
        <small id="location" class="text-muted hidden-xs hidden-sm"><i class="icon icon-map-marker"></i> 北京, 中国</small>
      </div>
      
      <div class="search" id="search-form-wrap">

    <form class="search-form sidebar-form">
        <div class="input-group">
            <input type="text" class="search-form-input form-control" placeholder="搜索" />
            <span class="input-group-btn">
                <button type="submit" class="search-form-submit btn btn-flat" onclick="return false;"><i class="icon icon-search"></i></button>
            </span>
        </div>
    </form>
    <div class="ins-search">
  <div class="ins-search-mask"></div>
  <div class="ins-search-container">
    <div class="ins-input-wrapper">
      <input type="text" class="ins-search-input" placeholder="想要查找什么..." x-webkit-speech />
      <button type="button" class="close ins-close ins-selectable" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
    </div>
    <div class="ins-section-wrapper">
      <div class="ins-section-container"></div>
    </div>
  </div>
</div>


</div>
      <button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#main-navbar" aria-controls="main-navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
    </div>
    <nav id="main-navbar" class="collapse navbar-collapse" itemscope itemtype="http://schema.org/SiteNavigationElement" role="navigation">
      <ul class="nav navbar-nav main-nav ">
        
        
        <li class="menu-item menu-item-home">
          <a href="/.">
            
            <i class="icon icon-home-fill"></i>
            
            <span class="menu-title">首页</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-archives">
          <a href="/archives">
            
            <i class="icon icon-archives-fill"></i>
            
            <span class="menu-title">归档</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-categories">
          <a href="/categories">
            
            <i class="icon icon-folder"></i>
            
            <span class="menu-title">分类</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-tags">
          <a href="/tags">
            
            <i class="icon icon-tags"></i>
            
            <span class="menu-title">标签</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-repository">
          <a href="/repository">
            
            <i class="icon icon-project"></i>
            
            <span class="menu-title">项目</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-books">
          <a href="/books">
            
            <i class="icon icon-book-fill"></i>
            
            <span class="menu-title">书单</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-links">
          <a href="/links">
            
            <i class="icon icon-friendship"></i>
            
            <span class="menu-title">友链</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-about">
          <a href="/about">
            
            <i class="icon icon-cup-fill"></i>
            
            <span class="menu-title">关于</span>
          </a>
        </li>
        
      </ul>
      
	
    <ul class="social-links">
    	
        <li><a href="https://github.com/wangyufei123" target="_blank" title="Github" data-toggle=tooltip data-placement=top><i class="icon icon-github"></i></a></li>
        
        <li><a href="/atom.xml" target="_blank" title="Rss" data-toggle=tooltip data-placement=top><i class="icon icon-rss"></i></a></li>
        
    </ul>

    </nav>
  </div>
</header>

  
    <aside class="sidebar" itemscope itemtype="http://schema.org/WPSideBar">
  <div class="slimContent">
    
      <div class="widget">
    <h3 class="widget-title">公告</h3>
    <div class="widget-body">
        <div id="board">
            <div class="content">
                <p>欢迎交流与分享经验!</p>
            </div>
        </div>
    </div>
</div>

    
      
  <div class="widget">
    <h3 class="widget-title">分类</h3>
    <div class="widget-body">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Mac/">Mac</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/google/">google</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/java/">java</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/mybatis/">mybatis</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%AD%A6%E4%B9%A0%E8%AE%A1%E5%88%92/">学习计划</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%BD%91%E7%BB%9C%E5%9C%A8%E5%9C%A8%E7%BA%BF%E4%BC%A0%E8%BE%93%E5%B7%A5%E5%85%B7/">网络在在线传输工具</a><span class="category-list-count">1</span></li></ul>
    </div>
  </div>


    
      
  <div class="widget">
    <h3 class="widget-title">标签</h3>
    <div class="widget-body">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/JDK1-8/" rel="tag">JDK1.8</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Mac/" rel="tag">Mac</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Tampermonkey/" rel="tag">Tampermonkey</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/activiti6-0/" rel="tag">activiti6.0</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/google-diriver/" rel="tag">google diriver</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/java/" rel="tag">java</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/maven/" rel="tag">maven</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mybatis/" rel="tag">mybatis</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/oracle/" rel="tag">oracle</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sqlserver/" rel="tag">sqlserver</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%A5%B6%E7%89%9B%E5%BF%AB%E4%BC%A0/" rel="tag">奶牛快传</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%AD%A6%E4%B9%A0%E8%AE%A1%E5%88%92/" rel="tag">学习计划</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%96%87%E4%BB%B6%E4%BC%A0%E8%BE%93/" rel="tag">文件传输</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%B2%B9%E7%8C%B4/" rel="tag">油猴</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BD%91%E7%BB%9C%E5%9C%A8%E5%9C%A8%E7%BA%BF%E4%BC%A0%E8%BE%93%E5%B7%A5%E5%85%B7/" rel="tag">网络在在线传输工具</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%B0%83%E8%AF%95/" rel="tag">调试</a><span class="tag-list-count">1</span></li></ul>
    </div>
  </div>


    
      
  <div class="widget">
    <h3 class="widget-title">标签云</h3>
    <div class="widget-body tagcloud">
      <a href="/tags/JDK1-8/" style="font-size: 13px;">JDK1.8</a> <a href="/tags/Mac/" style="font-size: 13px;">Mac</a> <a href="/tags/Tampermonkey/" style="font-size: 13px;">Tampermonkey</a> <a href="/tags/activiti6-0/" style="font-size: 13px;">activiti6.0</a> <a href="/tags/google-diriver/" style="font-size: 13px;">google diriver</a> <a href="/tags/java/" style="font-size: 13px;">java</a> <a href="/tags/maven/" style="font-size: 14px;">maven</a> <a href="/tags/mybatis/" style="font-size: 13px;">mybatis</a> <a href="/tags/oracle/" style="font-size: 13px;">oracle</a> <a href="/tags/sqlserver/" style="font-size: 13px;">sqlserver</a> <a href="/tags/%E5%A5%B6%E7%89%9B%E5%BF%AB%E4%BC%A0/" style="font-size: 13px;">奶牛快传</a> <a href="/tags/%E5%AD%A6%E4%B9%A0%E8%AE%A1%E5%88%92/" style="font-size: 13px;">学习计划</a> <a href="/tags/%E6%96%87%E4%BB%B6%E4%BC%A0%E8%BE%93/" style="font-size: 13px;">文件传输</a> <a href="/tags/%E6%B2%B9%E7%8C%B4/" style="font-size: 13px;">油猴</a> <a href="/tags/%E7%BD%91%E7%BB%9C%E5%9C%A8%E5%9C%A8%E7%BA%BF%E4%BC%A0%E8%BE%93%E5%B7%A5%E5%85%B7/" style="font-size: 13px;">网络在在线传输工具</a> <a href="/tags/%E8%B0%83%E8%AF%95/" style="font-size: 13px;">调试</a>
    </div>
  </div>

    
      
  <div class="widget">
    <h3 class="widget-title">归档</h3>
    <div class="widget-body">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/09/">九月 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/08/">八月 2020</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">六月 2020</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/05/">五月 2020</a><span class="archive-list-count">8</span></li></ul>
    </div>
  </div>


    
      
  <div class="widget">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget-body">
      <ul class="recent-post-list list-unstyled no-thumbnail">
        
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                
              </p>
              <p class="item-title">
                <a href="/posts/2e26b41f.html" class="title">Spring_Cloud笔记一</a>
              </p>
              <p class="item-date">
                <time datetime="2020-09-05T04:47:11.000Z" itemprop="datePublished">2020-09-05</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                
              </p>
              <p class="item-title">
                <a href="/posts/undefined.html" class="title">Centos7下静默安装Oracle 11g</a>
              </p>
              <p class="item-date">
                <time datetime="2020-08-23T09:38:23.000Z" itemprop="datePublished">2020-08-23</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                
              </p>
              <p class="item-title">
                <a href="/posts/671486fb.html" class="title">MySQL学习笔记二</a>
              </p>
              <p class="item-date">
                <time datetime="2020-08-17T01:04:45.000Z" itemprop="datePublished">2020-08-17</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                
              </p>
              <p class="item-title">
                <a href="/posts/f2612c14.html" class="title">MySQL高级部分学习一</a>
              </p>
              <p class="item-date">
                <time datetime="2020-08-17T01:04:14.000Z" itemprop="datePublished">2020-08-17</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                
              </p>
              <p class="item-title">
                <a href="/posts/8d9f420d.html" class="title">MySQL数据库学习笔记.md</a>
              </p>
              <p class="item-date">
                <time datetime="2020-08-17T01:03:37.000Z" itemprop="datePublished">2020-08-17</time>
              </p>
            </div>
          </li>
          
      </ul>
    </div>
  </div>
  

    
  </div>
</aside>

  
  
<main class="main" role="main">
  <div class="content">
  <article id="post-Spring-Cloud笔记一" class="article article-type-post" itemscope itemtype="http://schema.org/BlogPosting">
    
    <div class="article-header">
      
        <!--首页的文章标题会走到这个页面-->

  
    <h1 class="article-title" itemprop="name">
      Spring_Cloud笔记一
    </h1>
  

      
      <div class="article-meta">
        <span class="article-date">
    <i class="icon icon-calendar-check"></i>
	<a href="/posts/2e26b41f.html" class="article-date">
	  <time datetime="2020-09-05T04:47:11.000Z" itemprop="datePublished">2020-09-05</time>
	</a>
</span>
        
        

        
	<span class="article-read hidden-xs">
	    <i class="icon icon-eye-fill" aria-hidden="true"></i>
	    <span id="busuanzi_container_page_pv">
			<span id="busuanzi_value_page_pv">0</span>
		</span>
	</span>


        <span class="post-comment"><i class="icon icon-comment"></i> <a href="/posts/2e26b41f.html#comments" class="article-comment-link">评论</a></span>
        
	
		<span class="post-wordcount hidden-xs" itemprop="wordCount">字数统计: 20.7k(字)</span>
	
	
		<span class="post-readcount hidden-xs" itemprop="timeRequired">阅读时长: 102(分)</span>
	

      </div>
    </div>
    <div class="article-entry marked-body" itemprop="articleBody">
      
        <h1 id="SpringCloud微服务"><a href="#SpringCloud微服务" class="headerlink" title="SpringCloud微服务"></a>SpringCloud微服务</h1><h2 id="1-微服务架构编码构建"><a href="#1-微服务架构编码构建" class="headerlink" title="1. 微服务架构编码构建"></a>1. 微服务架构编码构建</h2><h3 id="1-1-IDEA新建project工作空间"><a href="#1-1-IDEA新建project工作空间" class="headerlink" title="1.1 IDEA新建project工作空间"></a>1.1 IDEA新建project工作空间</h3><p>创建父工程步骤:</p>
<ol>
<li><p>微服务cloud整体聚合父工程Project</p>
<ul>
<li><p>NewProject<br><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ghrsexqhlnj31lq0m646d.jpg" alt=""></p>
</li>
<li><p>聚合总工程名字:cloud2020</p>
</li>
<li><p>Maven选版本:3.6.3</p>
</li>
<li><p>工程名字****</p>
</li>
<li><p>字符编码<br><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ghrsumj5jxj314h0u0gv4.jpg" alt=""></p>
</li>
<li><p>注解生效激活<br><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ghrswv04h1j31hy0oqjz7.jpg" alt=""></p>
</li>
<li><p>java编译版本选jdk1.8<br><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ghrsy39tbij31hy0jgdkt.jpg" alt=""></p>
</li>
<li><p>File Type过滤<br><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ghrt1bozpmj31470u0aim.jpg" alt=""><br>填入的代码块：</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">*.hprof;*.idea;*.iml;*.pyc;*.pyo;*.rbc;*.yarb;*~;.DS_Store;.git;.hg;.svn;CVS;__pycache__;_svn;vssver.scc;vssver2.scc;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>父工程POM</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;?&gt;</span><br><span class="line"></span><br><span class="line">&lt;project xmlns&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0&quot; xmlns:xsi&#x3D;&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;2001&#x2F;XMLSchema-instance&quot;</span><br><span class="line">  xsi:schemaLocation&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0 http:&#x2F;&#x2F;maven.apache.org&#x2F;xsd&#x2F;maven-4.0.0.xsd&quot;&gt;</span><br><span class="line">  &lt;modelVersion&gt;4.0.0&lt;&#x2F;modelVersion&gt;</span><br><span class="line"></span><br><span class="line">  &lt;groupId&gt;com.atguigu.springcloud&lt;&#x2F;groupId&gt;</span><br><span class="line">  &lt;artifactId&gt;cloud2020&lt;&#x2F;artifactId&gt;</span><br><span class="line">  &lt;version&gt;1.0-SNAPSHOT&lt;&#x2F;version&gt;</span><br><span class="line">  &lt;!--表示这是一个pom父工程的文件--&gt;</span><br><span class="line">  &lt;packaging&gt;pom&lt;&#x2F;packaging&gt;</span><br><span class="line"></span><br><span class="line">  &lt;!-- 统一管理jar包版本 --&gt;</span><br><span class="line">  &lt;properties&gt;</span><br><span class="line">    &lt;project.build.sourceEncoding&gt;UTF-8&lt;&#x2F;project.build.sourceEncoding&gt;</span><br><span class="line">    &lt;maven.compiler.source&gt;1.8&lt;&#x2F;maven.compiler.source&gt;</span><br><span class="line">    &lt;maven.compiler.target&gt;1.8&lt;&#x2F;maven.compiler.target&gt;</span><br><span class="line">    &lt;junit.version&gt;4.12&lt;&#x2F;junit.version&gt;</span><br><span class="line">    &lt;log4j.version&gt;1.2.17&lt;&#x2F;log4j.version&gt;</span><br><span class="line">    &lt;lombok.version&gt;1.16.18&lt;&#x2F;lombok.version&gt;</span><br><span class="line">    &lt;mysql.version&gt;8.0.19&lt;&#x2F;mysql.version&gt;</span><br><span class="line">    &lt;druid.version&gt;1.1.16&lt;&#x2F;druid.version&gt;</span><br><span class="line">    &lt;mybatis.spring.boot.version&gt;1.3.0&lt;&#x2F;mybatis.spring.boot.version&gt;</span><br><span class="line">  &lt;&#x2F;properties&gt;</span><br><span class="line">  &lt;!-- 子模块继承之后，提供作用：锁定版本+子modlue不用写groupId和version  --&gt;</span><br><span class="line">  &lt;dependencyManagement&gt;</span><br><span class="line">    &lt;dependencies&gt;</span><br><span class="line">      &lt;!--spring boot 2.2.2--&gt;</span><br><span class="line">      &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;spring-boot-dependencies&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;version&gt;2.2.2.RELEASE&lt;&#x2F;version&gt;</span><br><span class="line">        &lt;type&gt;pom&lt;&#x2F;type&gt;</span><br><span class="line">        &lt;scope&gt;import&lt;&#x2F;scope&gt;</span><br><span class="line">      &lt;&#x2F;dependency&gt;</span><br><span class="line">      &lt;!--spring cloud Hoxton.SR1--&gt;</span><br><span class="line">      &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;org.springframework.cloud&lt;&#x2F;groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;spring-cloud-dependencies&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;version&gt;Hoxton.SR1&lt;&#x2F;version&gt;</span><br><span class="line">        &lt;type&gt;pom&lt;&#x2F;type&gt;</span><br><span class="line">        &lt;scope&gt;import&lt;&#x2F;scope&gt;</span><br><span class="line">      &lt;&#x2F;dependency&gt;</span><br><span class="line">      &lt;!--spring cloud alibaba 2.1.0.RELEASE--&gt;</span><br><span class="line">      &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;com.alibaba.cloud&lt;&#x2F;groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;spring-cloud-alibaba-dependencies&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;version&gt;2.1.0.RELEASE&lt;&#x2F;version&gt;</span><br><span class="line">        &lt;type&gt;pom&lt;&#x2F;type&gt;</span><br><span class="line">        &lt;scope&gt;import&lt;&#x2F;scope&gt;</span><br><span class="line">      &lt;&#x2F;dependency&gt;</span><br><span class="line">      &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;mysql&lt;&#x2F;groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;mysql-connector-java&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;version&gt;$&#123;mysql.version&#125;&lt;&#x2F;version&gt;</span><br><span class="line">      &lt;&#x2F;dependency&gt;</span><br><span class="line">      &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;com.alibaba&lt;&#x2F;groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;druid&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;version&gt;$&#123;druid.version&#125;&lt;&#x2F;version&gt;</span><br><span class="line">      &lt;&#x2F;dependency&gt;</span><br><span class="line">      &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;org.mybatis.spring.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;mybatis-spring-boot-starter&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;version&gt;$&#123;mybatis.spring.boot.version&#125;&lt;&#x2F;version&gt;</span><br><span class="line">      &lt;&#x2F;dependency&gt;</span><br><span class="line">      &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;junit&lt;&#x2F;groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;junit&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;version&gt;$&#123;junit.version&#125;&lt;&#x2F;version&gt;</span><br><span class="line">      &lt;&#x2F;dependency&gt;</span><br><span class="line">      &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;log4j&lt;&#x2F;groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;log4j&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;version&gt;$&#123;log4j.version&#125;&lt;&#x2F;version&gt;</span><br><span class="line">      &lt;&#x2F;dependency&gt;</span><br><span class="line">      &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;org.projectlombok&lt;&#x2F;groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;lombok&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;version&gt;$&#123;lombok.version&#125;&lt;&#x2F;version&gt;</span><br><span class="line">        &lt;optional&gt;true&lt;&#x2F;optional&gt;</span><br><span class="line">      &lt;&#x2F;dependency&gt;</span><br><span class="line">    &lt;&#x2F;dependencies&gt;</span><br><span class="line">  &lt;&#x2F;dependencyManagement&gt;</span><br><span class="line">  &lt;build&gt;</span><br><span class="line">    &lt;plugins&gt;</span><br><span class="line">      &lt;plugin&gt;</span><br><span class="line">        &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;spring-boot-maven-plugin&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;configuration&gt;</span><br><span class="line">          &lt;fork&gt;true&lt;&#x2F;fork&gt;</span><br><span class="line">          &lt;addResources&gt;true&lt;&#x2F;addResources&gt;</span><br><span class="line">        &lt;&#x2F;configuration&gt;</span><br><span class="line">      &lt;&#x2F;plugin&gt;</span><br><span class="line">    &lt;&#x2F;plugins&gt;</span><br><span class="line">  &lt;&#x2F;build&gt;</span><br><span class="line">&lt;&#x2F;project&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Maven工程落地细节复习</p>
<ul>
<li>Maven中的DependencyManager和dependencies<br>maven使用DependencyManager元素来提供了一种管理依赖版本号的方式。<strong><em>==通常会在一个组织或者项目的最顶层的父pom中看到此元素。==</em></strong><br>使用dependencyManagement可以使所有子项目中引用一个依赖而不用显示列出版本号。Maven会沿父子层级向上走，直到找到dependencyManagement元素的项目 ，然后它就会使用版本号<br>如果某一个子项目需要另外一个版本，加上version即可。如果子项目中声明了版本号，那么使用子项目中的jar包。</li>
</ul>
</li>
</ol>
<p><strong><em>==dependencyManagement只是声明依赖，并不实现引入，一次子项目需要显式的声明需要用的依赖。==</em></strong></p>
<pre><code>* maven中跳过单元测试</code></pre><ol start="2">
<li>父工程创建完成后执行<code>mvn:install</code>将父工程发不到仓库方便子工程继承<br><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ghru63tkvyj30qm0so1kx.jpg" alt=""></li>
</ol>
<h3 id="1-2-Rest微服务工程构建"><a href="#1-2-Rest微服务工程构建" class="headerlink" title="1.2 Rest微服务工程构建"></a>1.2 Rest微服务工程构建</h3><h4 id="1-2-1-构建步骤"><a href="#1-2-1-构建步骤" class="headerlink" title="1.2.1 构建步骤"></a>1.2.1 构建步骤</h4><h5 id="1-2-1-1-Cloud-provider-payment8001微服务提供者支付Module模块"><a href="#1-2-1-1-Cloud-provider-payment8001微服务提供者支付Module模块" class="headerlink" title="1.2.1.1 Cloud-provider-payment8001微服务提供者支付Module模块"></a>1.2.1.1 Cloud-provider-payment8001微服务提供者支付Module模块</h5><ol>
<li><p>建cloud-provider-payment8001<br><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ghrufr0a73j31b20u0n7f.jpg" alt=""></p>
</li>
<li><p>改pom文件</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">    &lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;project xmlns&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0&quot;</span><br><span class="line">         xmlns:xsi&#x3D;&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;2001&#x2F;XMLSchema-instance&quot;</span><br><span class="line">         xsi:schemaLocation&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0 http:&#x2F;&#x2F;maven.apache.org&#x2F;xsd&#x2F;maven-4.0.0.xsd&quot;&gt;</span><br><span class="line">    &lt;parent&gt;</span><br><span class="line">        &lt;artifactId&gt;cloud2020&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;groupId&gt;com.atguigu.springcloud&lt;&#x2F;groupId&gt;</span><br><span class="line">        &lt;version&gt;1.0-SNAPSHOT&lt;&#x2F;version&gt;</span><br><span class="line">    &lt;&#x2F;parent&gt;</span><br><span class="line">    &lt;modelVersion&gt;4.0.0&lt;&#x2F;modelVersion&gt;</span><br><span class="line"></span><br><span class="line">    &lt;artifactId&gt;cloud-provider-payment8001&lt;&#x2F;artifactId&gt;</span><br><span class="line"></span><br><span class="line">    &lt;dependencies&gt;</span><br><span class="line">        &lt;!-- https:&#x2F;&#x2F;mvnrepository.com&#x2F;artifact&#x2F;org.springframework.boot&#x2F;spring-boot-starter-web --&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-web&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;!-- https:&#x2F;&#x2F;mvnrepository.com&#x2F;artifact&#x2F;org.springframework.boot&#x2F;spring-boot-starter-web --&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-actuator&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;!-- https:&#x2F;&#x2F;mvnrepository.com&#x2F;artifact&#x2F;org.springframework.boot&#x2F;spring-boot-starter-web --&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.mybatis.spring.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;mybatis-spring-boot-starter&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;!-- https:&#x2F;&#x2F;mvnrepository.com&#x2F;artifact&#x2F;com.alibaba&#x2F;druid --&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;com.alibaba&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;druid-spring-boot-starter&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;version&gt;1.1.10&lt;&#x2F;version&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;!-- https:&#x2F;&#x2F;mvnrepository.com&#x2F;artifact&#x2F;mysql&#x2F;mysql-connector-java --&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;mysql&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;mysql-connector-java&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;!-- https:&#x2F;&#x2F;mvnrepository.com&#x2F;artifact&#x2F;org.springframework.boot&#x2F;spring-boot-starter-jdbc --&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-jdbc&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;!-- https:&#x2F;&#x2F;mvnrepository.com&#x2F;artifact&#x2F;org.springframework.boot&#x2F;spring-boot-devtools --&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-devtools&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;scope&gt;runtime&lt;&#x2F;scope&gt;</span><br><span class="line">            &lt;optional&gt;true&lt;&#x2F;optional&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;!-- https:&#x2F;&#x2F;mvnrepository.com&#x2F;artifact&#x2F;org.projectlombok&#x2F;lombok --&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.projectlombok&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;lombok&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;optional&gt;true&lt;&#x2F;optional&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;!-- https:&#x2F;&#x2F;mvnrepository.com&#x2F;artifact&#x2F;org.springframework.boot&#x2F;spring-boot-starter-test --&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-test&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;scope&gt;test&lt;&#x2F;scope&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;!--&lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-autoconfigure&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;version&gt;2.3.1.RELEASE&lt;&#x2F;version&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;--&gt;</span><br><span class="line">    &lt;&#x2F;dependencies&gt;</span><br><span class="line">&lt;&#x2F;project&gt;</span><br></pre></td></tr></table></figure></li>
<li><p>写yml</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">server:</span><br><span class="line">  port: 8001</span><br><span class="line"></span><br><span class="line">spring:</span><br><span class="line">  application:</span><br><span class="line">    name: cloud-payment-service</span><br><span class="line">  datasource:</span><br><span class="line">    driver-class-name: com.mysql.cj.jdbc.Driver</span><br><span class="line">    # serverTimezone&#x3D;CTT&amp;useUnicode&#x3D;true&amp;characterEncoding&#x3D;utf-8&amp;allowMultiQueries&#x3D;true</span><br><span class="line">    url: jdbc:mysql:&#x2F;&#x2F;111.229.203.5:3306&#x2F;db2019?serverTimezone&#x3D;CTT&amp;useUnicode&#x3D;true&amp;characterEncoding&#x3D;utf-8&amp;useSSL&#x3D;false</span><br><span class="line">    username: weaver</span><br><span class="line">    password: 192612</span><br><span class="line">    type: com.alibaba.druid.pool.DruidDataSource</span><br><span class="line"></span><br><span class="line">mybatis:</span><br><span class="line">  mapperLocations: classpath:mapper&#x2F;*.xml</span><br><span class="line">  type-aliases-package: com.atguigu.springcloud.entities</span><br></pre></td></tr></table></figure></li>
<li><p>主启动</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">package com.atguigu.springcloud;</span><br><span class="line"></span><br><span class="line">import org.springframework.boot.SpringApplication;</span><br><span class="line">import org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * @program: cloud2020</span><br><span class="line"> * @description: 主启动类</span><br><span class="line"> * @author: Mr.Wang</span><br><span class="line"> * @create: 2020-08-15-22-19</span><br><span class="line"> *&#x2F;</span><br><span class="line">@SpringBootApplication</span><br><span class="line">public class PaymentMain8001 &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        SpringApplication.run(PaymentMain8001.class,args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>业务类</p>
<ol>
<li><p>建表sql</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE &#96;payment&#96; (</span><br><span class="line">	&#96;id&#96; BIGINT (20) NOT NULL AUTO_INCREMENT COMMENT &#39;ID&#39;,</span><br><span class="line">	&#96;serial&#96; VARCHAR (200) DEFAULT&#39;&#39;,</span><br><span class="line">PRIMARY KEY (id)</span><br><span class="line">) ENGINE &#x3D; INNODB AUTO_INCREMENT &#x3D; 1 DEFAULT CHARSET &#x3D; utf8</span><br></pre></td></tr></table></figure></li>
<li><p>entitles</p>
<ul>
<li><p>主实体Payment</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">package com.atguigu.springcloud.entities;</span><br><span class="line"></span><br><span class="line">import lombok.AllArgsConstructor;</span><br><span class="line">import lombok.Data;</span><br><span class="line">import lombok.NoArgsConstructor;</span><br><span class="line"></span><br><span class="line">import java.io.Serializable;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * @program: cloud2020</span><br><span class="line"> * @description: 支付实体类</span><br><span class="line"> * @author: Mr.Wang</span><br><span class="line"> * @create: 2020-08-16-00-08</span><br><span class="line"> *&#x2F;</span><br><span class="line">@Data</span><br><span class="line">@AllArgsConstructor</span><br><span class="line">@NoArgsConstructor</span><br><span class="line">public class Payment implements Serializable &#123;</span><br><span class="line">    private Long id;</span><br><span class="line">    private String serial;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>son封装体CommonResult</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">package com.atguigu.springcloud.entities;</span><br><span class="line"></span><br><span class="line">import lombok.AllArgsConstructor;</span><br><span class="line">import lombok.Data;</span><br><span class="line">import lombok.NoArgsConstructor;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * @program: cloud2020</span><br><span class="line"> * @description: 穿结果给前端的类</span><br><span class="line"> * @author: Mr.Wang</span><br><span class="line"> * @create: 2020-08-16-00-14</span><br><span class="line"> *&#x2F;</span><br><span class="line">@Data</span><br><span class="line">@AllArgsConstructor</span><br><span class="line">@NoArgsConstructor</span><br><span class="line">public class CommonResult&lt;T&gt; &#123;</span><br><span class="line">    private Integer code;</span><br><span class="line">    private String message;</span><br><span class="line">    private T data;</span><br><span class="line">    public CommonResult(Integer code,String message)&#123;</span><br><span class="line">        this(code,message,null);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>dao</p>
<ul>
<li><p>接口PaymentDao</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">package com.atguigu.springcloud.dao;</span><br><span class="line"></span><br><span class="line">import com.atguigu.springcloud.entities.Payment;</span><br><span class="line">import org.apache.ibatis.annotations.Mapper;</span><br><span class="line">import org.apache.ibatis.annotations.Param;</span><br><span class="line">import org.springframework.stereotype.Repository;</span><br><span class="line">import org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;@Repository</span><br><span class="line">@Mapper</span><br><span class="line">public interface PaymentDao &#123;</span><br><span class="line">    public int create(Payment payment);</span><br><span class="line">    public Payment getPaymentById(@Param(&quot;id&quot;)Long id);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>mybatis的映射文件PaymentMapper.xml</p>
<ul>
<li><p>路径：<code>src\main\resources\mapper\PaymentMapper.xml</code></p>
</li>
<li><p>mapper映射文件</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE mapper</span><br><span class="line">        PUBLIC &#39;-&#x2F;&#x2F;mybatis.org&#x2F;&#x2F;DTD Mapper 3.0&#x2F;&#x2F;EN&#39;</span><br><span class="line">        &#39;http:&#x2F;&#x2F;mybatis.org&#x2F;dtd&#x2F;mybatis-3-mapper.dtd&#39;&gt;</span><br><span class="line">&lt;mapper namespace&#x3D;&quot;com.atguigu.springcloud.dao.PaymentDao&quot;&gt;</span><br><span class="line">    &lt;insert id&#x3D;&quot;create&quot; parameterType&#x3D;&quot;Payment&quot; useGeneratedKeys&#x3D;&quot;true&quot; keyProperty&#x3D;&quot;id&quot;&gt;</span><br><span class="line">        insert into payment(serial) values (#&#123;serial&#125;);</span><br><span class="line">    &lt;&#x2F;insert&gt;</span><br><span class="line">    &lt;resultMap id&#x3D;&quot;BaseResultMap&quot; type&#x3D;&quot;Payment&quot;&gt;</span><br><span class="line">        &lt;id column&#x3D;&quot;id&quot; property&#x3D;&quot;id&quot; jdbcType&#x3D;&quot;BIGINT&quot;&gt;&lt;&#x2F;id&gt;</span><br><span class="line">        &lt;result column&#x3D;&quot;serial&quot; property&#x3D;&quot;serial&quot; jdbcType&#x3D;&quot;VARCHAR&quot;&#x2F;&gt;</span><br><span class="line">    &lt;&#x2F;resultMap&gt;</span><br><span class="line">    &lt;select id&#x3D;&quot;getPaymentById&quot; parameterType&#x3D;&quot;Long&quot; resultMap&#x3D;&quot;BaseResultMap&quot;&gt;</span><br><span class="line">        select * from payment where id &#x3D; #&#123;id&#125;;</span><br><span class="line">    &lt;&#x2F;select&gt;</span><br><span class="line">&lt;&#x2F;mapper&gt;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
</li>
<li><p>service</p>
<ul>
<li><p>接口PaymentService</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">package com.atguigu.springcloud.service;</span><br><span class="line"></span><br><span class="line">import com.atguigu.springcloud.entities.Payment;</span><br><span class="line">import org.apache.ibatis.annotations.Param;</span><br><span class="line"></span><br><span class="line">public interface PaymentService &#123;</span><br><span class="line">    public int create(Payment payment);</span><br><span class="line">    public Payment getPaymentById(Long id);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>实现类</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">package com.atguigu.springcloud.service.impl;</span><br><span class="line"></span><br><span class="line">import com.atguigu.springcloud.dao.PaymentDao;</span><br><span class="line">import com.atguigu.springcloud.entities.Payment;</span><br><span class="line">import com.atguigu.springcloud.service.PaymentService;</span><br><span class="line">import org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line">import org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line">import javax.annotation.Resource;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * @program: cloud2020</span><br><span class="line"> * @description: 支付功能的service层</span><br><span class="line"> * @author: Mr.Wang</span><br><span class="line"> * @create: 2020-08-16-00-42</span><br><span class="line"> *&#x2F;</span><br><span class="line">@Service</span><br><span class="line">public class PaymentServiceImpl implements PaymentService &#123;</span><br><span class="line">    @Resource</span><br><span class="line">    private PaymentDao paymentDao;</span><br><span class="line">    @Override</span><br><span class="line">    public int create(Payment payment) &#123;</span><br><span class="line">        return paymentDao.create(payment);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public Payment getPaymentById(Long id) &#123;</span><br><span class="line">        return paymentDao.getPaymentById(id);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>controller</p>
</li>
</ol>
</li>
</ol>
<pre><code><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">package com.atguigu.springcloud.Controller;</span><br><span class="line"></span><br><span class="line">import com.atguigu.springcloud.entities.CommonResult;</span><br><span class="line">import com.atguigu.springcloud.entities.Payment;</span><br><span class="line">import com.atguigu.springcloud.service.PaymentService;</span><br><span class="line">import lombok.extern.slf4j.Slf4j;</span><br><span class="line">import org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line">import org.springframework.web.bind.annotation.*;</span><br><span class="line"></span><br><span class="line">import javax.annotation.Resource;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * @program: cloud2020</span><br><span class="line"> * @description: 支付的控制层</span><br><span class="line"> * @author: Mr.Wang</span><br><span class="line"> * @create: 2020-08-16-00-48</span><br><span class="line"> *&#x2F;</span><br><span class="line">@RestController</span><br><span class="line">@Slf4j</span><br><span class="line">public class PaymentController &#123;</span><br><span class="line"></span><br><span class="line">    @Resource</span><br><span class="line">    private PaymentService paymentService;</span><br><span class="line"></span><br><span class="line">    @PostMapping(value &#x3D; &quot;&#x2F;payment&#x2F;create&quot;)</span><br><span class="line">    public CommonResult create(Payment payment)&#123;</span><br><span class="line">        int result &#x3D; paymentService.create(payment);</span><br><span class="line">        log.info(&quot;****插入结果:&quot;+result);</span><br><span class="line">        if(result &gt; 0)&#123;</span><br><span class="line">            return new CommonResult(200,&quot;插入数据库成功&quot;,result);</span><br><span class="line">        &#125;else&#123;</span><br><span class="line">            return new CommonResult(444,&quot;插入数据失败&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @GetMapping(value &#x3D; &quot;&#x2F;payment&#x2F;get&#x2F;&#123;id&#125;&quot;)</span><br><span class="line">    public CommonResult getPaymentById(@PathVariable(&quot;id&quot;) Long id)&#123;</span><br><span class="line">        Payment payment &#x3D; paymentService.getPaymentById(id);</span><br><span class="line">        log.info(&quot;****查询结果:&quot;+payment);</span><br><span class="line">        if(payment !&#x3D; null)&#123;</span><br><span class="line">            return new CommonResult(200,&quot;查询成功&quot;,payment);</span><br><span class="line">        &#125;else&#123;</span><br><span class="line">            return new CommonResult(444,&quot;没有对应记录,查询查询失败&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></code></pre><h5 id="1-2-1-2-热部署Devtools"><a href="#1-2-1-2-热部署Devtools" class="headerlink" title="1.2.1.2 热部署Devtools"></a>1.2.1.2 热部署Devtools</h5><ol>
<li><p>Adding devtools to your project</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-devtools&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;scope&gt;runtime&lt;&#x2F;scope&gt;</span><br><span class="line">            &lt;optional&gt;true&lt;&#x2F;optional&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br></pre></td></tr></table></figure></li>
<li><p>Adding plugin to your pom.xml<br>下段的配置我们需要粘贴进聚合父类总工程的pom.xml里面</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;build&gt;</span><br><span class="line">    &lt;plugins&gt;</span><br><span class="line">      &lt;plugin&gt;</span><br><span class="line">        &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;spring-boot-maven-plugin&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;configuration&gt;</span><br><span class="line">          &lt;fork&gt;true&lt;&#x2F;fork&gt;</span><br><span class="line">          &lt;addResources&gt;true&lt;&#x2F;addResources&gt;</span><br><span class="line">        &lt;&#x2F;configuration&gt;</span><br><span class="line">      &lt;&#x2F;plugin&gt;</span><br><span class="line">    &lt;&#x2F;plugins&gt;</span><br><span class="line">  &lt;&#x2F;build&gt;</span><br></pre></td></tr></table></figure></li>
<li><p>Enabling automatic build<br><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ghsqe7i9egj314b0u0n5w.jpg" alt=""></p>
</li>
<li><p>Update the value of<br>使用快捷键<code>command+option+shift+/</code>选择<code>Registry</code><br><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ghsqkdotlwj30nc08mae8.jpg" alt=""><br><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ghsqlsjiadj31d80te79m.jpg" alt=""></p>
</li>
<li><p>重启IDEA<br>关闭并重新启动idea开发工具</p>
</li>
</ol>
<h5 id="1-2-1-3-cloud-consumer-order80微服务消费者订单Module模块"><a href="#1-2-1-3-cloud-consumer-order80微服务消费者订单Module模块" class="headerlink" title="1.2.1.3 cloud-consumer-order80微服务消费者订单Module模块"></a>1.2.1.3 cloud-consumer-order80微服务消费者订单Module模块</h5><ol>
<li><p>建cloud-consumer-order80<br>同8001服务端创建moudle的方法相同</p>
</li>
<li><p>改POM</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;project xmlns&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0&quot;</span><br><span class="line">         xmlns:xsi&#x3D;&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;2001&#x2F;XMLSchema-instance&quot;</span><br><span class="line">         xsi:schemaLocation&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0 http:&#x2F;&#x2F;maven.apache.org&#x2F;xsd&#x2F;maven-4.0.0.xsd&quot;&gt;</span><br><span class="line">    &lt;parent&gt;</span><br><span class="line">        &lt;artifactId&gt;cloud2020&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;groupId&gt;com.atguigu.springcloud&lt;&#x2F;groupId&gt;</span><br><span class="line">        &lt;version&gt;1.0-SNAPSHOT&lt;&#x2F;version&gt;</span><br><span class="line">    &lt;&#x2F;parent&gt;</span><br><span class="line">    &lt;modelVersion&gt;4.0.0&lt;&#x2F;modelVersion&gt;</span><br><span class="line"></span><br><span class="line">    &lt;artifactId&gt;cloud-consumer-order80&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;dependencies&gt;</span><br><span class="line">        &lt;!-- https:&#x2F;&#x2F;mvnrepository.com&#x2F;artifact&#x2F;org.springframework.boot&#x2F;spring-boot-starter-web --&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-web&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;!-- https:&#x2F;&#x2F;mvnrepository.com&#x2F;artifact&#x2F;org.springframework.boot&#x2F;spring-boot-starter-web  --&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-actuator&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;!-- https:&#x2F;&#x2F;mvnrepository.com&#x2F;artifact&#x2F;org.springframework.boot&#x2F;spring-boot-devtools --&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-devtools&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;scope&gt;runtime&lt;&#x2F;scope&gt;</span><br><span class="line">            &lt;optional&gt;true&lt;&#x2F;optional&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;!-- https:&#x2F;&#x2F;mvnrepository.com&#x2F;artifact&#x2F;org.projectlombok&#x2F;lombok --&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.projectlombok&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;lombok&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;optional&gt;true&lt;&#x2F;optional&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;!-- https:&#x2F;&#x2F;mvnrepository.com&#x2F;artifact&#x2F;org.springframework.boot&#x2F;spring-boot-starter-test --&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-test&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;scope&gt;test&lt;&#x2F;scope&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">    &lt;&#x2F;dependencies&gt;</span><br><span class="line"></span><br><span class="line">&lt;&#x2F;project&gt;</span><br></pre></td></tr></table></figure></li>
<li><p>写YML</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">server:</span><br><span class="line">    port: 80</span><br></pre></td></tr></table></figure></li>
<li><p>主启动<br>同上</p>
</li>
<li><p>业务类</p>
<ul>
<li><p>RestTemplate是什么<br>RestTemplate提供了多种便捷访问远程Http服务的方法<br>是一种简单便捷的访问restful服务模版累，是Spring提供的用于访问Rest服务的客户端模版工具集</p>
</li>
<li><p>官网及使用<br><a href="https://docs.spring.io/spring-framework/docs/5.2.2.RELEASE/javadoc-api/org/springframework/web/client/RestTemplate.html" target="_blank" rel="noopener">官网地址</a></p>
</li>
<li><p><strong>使用:*</strong><br>使用restTemplate访问restful接口非常的简单粗暴无脑。(url,requestMap,ResponseBean.class)这三个参数分别代表Rest请求地址、请求参数、Http响应转换被转换成对象类型</p>
</li>
<li><p>config配置类</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">package com.atguigu.springcloud.config;</span><br><span class="line"></span><br><span class="line">import org.springframework.beans.factory.annotation.Configurable;</span><br><span class="line">import org.springframework.context.annotation.Bean;</span><br><span class="line">import org.springframework.context.annotation.Configuration;</span><br><span class="line">import org.springframework.web.client.RestTemplate;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * @program: cloud2020</span><br><span class="line"> * @description: 配置类</span><br><span class="line"> * @author: Mr.Wang</span><br><span class="line"> * @create: 2020-08-16-20-33</span><br><span class="line"> *&#x2F;</span><br><span class="line"></span><br><span class="line">@Configuration</span><br><span class="line">public class ApplicationContextConfig &#123;</span><br><span class="line">    @Bean</span><br><span class="line">    public RestTemplate getRestTemplate()&#123;</span><br><span class="line">        return new RestTemplate();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>创建controller</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">package com.atguigu.springcloud.controller;</span><br><span class="line"></span><br><span class="line">import com.atguigu.springcloud.entities.CommonResult;</span><br><span class="line">import com.atguigu.springcloud.entities.Payment;</span><br><span class="line">import lombok.extern.slf4j.Slf4j;</span><br><span class="line">import org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line">import org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line">import org.springframework.web.bind.annotation.PathVariable;</span><br><span class="line">import org.springframework.web.bind.annotation.RestController;</span><br><span class="line">import org.springframework.web.client.RestTemplate;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * @program: cloud2020</span><br><span class="line"> * @description: 订单类web层</span><br><span class="line"> * @author: Mr.Wang</span><br><span class="line"> * @create: 2020-08-16-19-57</span><br><span class="line"> *&#x2F;</span><br><span class="line">@RestController</span><br><span class="line">@Slf4j</span><br><span class="line">public class OrderController &#123;</span><br><span class="line">    public static final String PAYMENT_URL &#x3D; &quot;http:&#x2F;&#x2F;localhost:8001&quot;;</span><br><span class="line">    @Autowired</span><br><span class="line">    private RestTemplate restTemplate;</span><br><span class="line"></span><br><span class="line">    @GetMapping(&quot;&#x2F;consumer&#x2F;payment&#x2F;create&quot;)</span><br><span class="line">    public CommonResult&lt;Payment&gt; create(Payment payment)&#123;</span><br><span class="line">        return restTemplate.postForObject(PAYMENT_URL+&quot;&#x2F;payment&#x2F;create&quot;,payment,CommonResult.class);</span><br><span class="line">    &#125;</span><br><span class="line">    @GetMapping(&quot;&#x2F;consumer&#x2F;payment&#x2F;get&#x2F;&#123;id&#125;&quot;)</span><br><span class="line">    public CommonResult&lt;Payment&gt; getPayment(@PathVariable(&quot;id&quot;)Long id)&#123;</span><br><span class="line">        return restTemplate.getForObject(PAYMENT_URL+&quot;&#x2F;payment&#x2F;get&#x2F;&quot;+id,CommonResult.class);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>测试</p>
<ul>
<li>先启动cloud-provider-payment8001</li>
<li>再启动cloud-consumer-order80</li>
<li>idea右下角弹出窗口，选择show，共同管理两个端口号</li>
<li>使用<a href="http://localhost/consumer/payment/get/31访问，80为默认端口号可省略不写" target="_blank" rel="noopener">http://localhost/consumer/payment/get/31访问，80为默认端口号可省略不写</a></li>
<li>不要忘记<code>@RequestBody</code>注解</li>
</ul>
</li>
<li><p>Run Dashboard的配置</p>
<ul>
<li><p>通过修改idea的workspace.xml的方式来快速打开Run Dashboard窗口</p>
</li>
<li><p>开启Run DashBoard</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;option name&#x3D;&quot;configurationTypes&quot;&gt;</span><br><span class="line">      &lt;set&gt;</span><br><span class="line">        &lt;option value&#x3D;&quot;SpringBootApplicationConfigurationType&quot; &#x2F;&gt;</span><br><span class="line">      &lt;&#x2F;set&gt;</span><br><span class="line">    &lt;&#x2F;option&gt;</span><br></pre></td></tr></table></figure></li>
<li><p>可能由于idea版本的不同，需要关闭重新启动</p>
</li>
</ul>
</li>
</ol>
<h5 id="1-2-1-4-工程重构"><a href="#1-2-1-4-工程重构" class="headerlink" title="1.2.1.4 工程重构"></a>1.2.1.4 工程重构</h5><ol>
<li><p>观察问题<br>系统中有重复的部分，需要进行重构</p>
</li>
<li><p>新建-cloud-api-commons</p>
</li>
<li><p>pom</p>
<pre><code><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;project xmlns&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0&quot;</span><br><span class="line">         xmlns:xsi&#x3D;&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;2001&#x2F;XMLSchema-instance&quot;</span><br><span class="line">         xsi:schemaLocation&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0 http:&#x2F;&#x2F;maven.apache.org&#x2F;xsd&#x2F;maven-4.0.0.xsd&quot;&gt;</span><br><span class="line">    &lt;parent&gt;</span><br><span class="line">        &lt;artifactId&gt;cloud2020&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;groupId&gt;com.atguigu.springcloud&lt;&#x2F;groupId&gt;</span><br><span class="line">        &lt;version&gt;1.0-SNAPSHOT&lt;&#x2F;version&gt;</span><br><span class="line">    &lt;&#x2F;parent&gt;</span><br><span class="line">    &lt;modelVersion&gt;4.0.0&lt;&#x2F;modelVersion&gt;</span><br><span class="line"></span><br><span class="line">    &lt;artifactId&gt;cloud-api-commons&lt;&#x2F;artifactId&gt;</span><br><span class="line"></span><br><span class="line">    &lt;dependencies&gt;</span><br><span class="line">        &lt;!-- https:&#x2F;&#x2F;mvnrepository.com&#x2F;artifact&#x2F;org.springframework.boot&#x2F;spring-boot-devtools --&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-devtools&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;scope&gt;runtime&lt;&#x2F;scope&gt;</span><br><span class="line">            &lt;optional&gt;true&lt;&#x2F;optional&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.projectlombok&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;lombok&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;optional&gt;true&lt;&#x2F;optional&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;!-- https:&#x2F;&#x2F;mvnrepository.com&#x2F;artifact&#x2F;cn.hutool&#x2F;hutool-all --&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;cn.hutool&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;hutool-all&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;version&gt;5.1.0&lt;&#x2F;version&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">    &lt;&#x2F;dependencies&gt;</span><br><span class="line"></span><br><span class="line">&lt;&#x2F;project&gt;</span><br></pre></td></tr></table></figure></code></pre></li>
<li><p>entities</p>
</li>
<li><p>maven命令<code>clean install</code></p>
</li>
<li><p>订单80和支付8001分别改造</p>
<ul>
<li><p>删除各自的原先有过的entities文件夹</p>
</li>
<li><p>各自黏贴pom内容</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--引入自定义的api通用包--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;com.atguigu.springcloud&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;cloud-api-commons&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;version&gt;1.0-SNAPSHOT&lt;&#x2F;version&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br></pre></td></tr></table></figure>

</li>
</ul>
</li>
</ol>
<h4 id="1-2-2-目前工程详图"><a href="#1-2-2-目前工程详图" class="headerlink" title="1.2.2 目前工程详图"></a>1.2.2 目前工程详图</h4><h2 id="2-Eureka服务注册与发现"><a href="#2-Eureka服务注册与发现" class="headerlink" title="2. Eureka服务注册与发现"></a>2. Eureka服务注册与发现</h2><h3 id="2-1-Eureka基础知识"><a href="#2-1-Eureka基础知识" class="headerlink" title="2.1 Eureka基础知识"></a>2.1 Eureka基础知识</h3><ol>
<li><p>什么是服务治理</p>
</li>
<li><p>什么是服务注册<br>Eureka Server 作为服务注册功能的服务器，它是服务注册中心，而系统中其他微服务，使用 Eureka 的客户端连接到 Eureka Server 并维持心跳连接，这样系统维护人员就可以通过 Eureka Server来监控各个微服务是否正常运行。<br>在服务注册与发现中有一个注册中心，服务器启动时，会把当前自己的服务器信息比如服务地址，通信地址等注册到注册中心上，另一方（消费者）以别名的方式在注册中心上获取实际的服务器通讯地址，然后再实现本地RPC调用远程RPC。<br><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ghtrn44cudj31b90gngtz.jpg" alt=""></p>
</li>
<li><p>Eureka两组件</p>
<ol>
<li>Eureka Server 提供服务注册服务<br>各个微服务节点通过配置启动后，会在 EurekaServer中进行注册，这样 EurekaServer中的服务注册表中将会存储所有可用服务节点的信息。</li>
<li>EurekaClient通过注册中心进行访问<br>是一个Java客户端，用于简化与 Eureka Server的交互，客户端也同时具备一个内置的，使用 轮询负载算法的负载均衡器。在应用启动后，将会向Eureka Server 发送心跳（默认周期30秒）。如果Eureka Server 在多个心跳周期内没有接收到某个节点的心跳，EurekaServer将会从服务注册表中将这个服务节点移除（默认90秒）</li>
</ol>
</li>
</ol>
<h3 id="2-2-单机Eureka构建步骤"><a href="#2-2-单机Eureka构建步骤" class="headerlink" title="2.2 单机Eureka构建步骤"></a>2.2 单机Eureka构建步骤</h3><h4 id="2-2-1-IDEA生成eurekaServer端服务注册中心类似物业公司"><a href="#2-2-1-IDEA生成eurekaServer端服务注册中心类似物业公司" class="headerlink" title="2.2.1 IDEA生成eurekaServer端服务注册中心类似物业公司"></a>2.2.1 IDEA生成eurekaServer端服务注册中心类似物业公司</h4><ol>
<li><p>建Moudel<code>cloud-eureka-server7001</code></p>
</li>
<li><p>改POM</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;project xmlns&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0&quot;</span><br><span class="line">         xmlns:xsi&#x3D;&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;2001&#x2F;XMLSchema-instance&quot;</span><br><span class="line">         xsi:schemaLocation&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0 http:&#x2F;&#x2F;maven.apache.org&#x2F;xsd&#x2F;maven-4.0.0.xsd&quot;&gt;</span><br><span class="line">    &lt;parent&gt;</span><br><span class="line">        &lt;artifactId&gt;cloud2020&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;groupId&gt;com.atguigu.springcloud&lt;&#x2F;groupId&gt;</span><br><span class="line">        &lt;version&gt;1.0-SNAPSHOT&lt;&#x2F;version&gt;</span><br><span class="line">    &lt;&#x2F;parent&gt;</span><br><span class="line">    &lt;modelVersion&gt;4.0.0&lt;&#x2F;modelVersion&gt;</span><br><span class="line"></span><br><span class="line">    &lt;artifactId&gt;cloud-eureka-server7001&lt;&#x2F;artifactId&gt;</span><br><span class="line"></span><br><span class="line">    &lt;dependencies&gt;</span><br><span class="line">        &lt;!-- https:&#x2F;&#x2F;mvnrepository.com&#x2F;artifact&#x2F;org.springframework.cloud&#x2F;spring-cloud-starter-eureka-server --&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.cloud&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-cloud-starter-netflix-eureka-server&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;com.atguigu.springcloud&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;cloud-api-commons&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;version&gt;1.0-SNAPSHOT&lt;&#x2F;version&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;!-- https:&#x2F;&#x2F;mvnrepository.com&#x2F;artifact&#x2F;org.springframework.boot&#x2F;spring-boot-starter-web --&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-web&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;!-- https:&#x2F;&#x2F;mvnrepository.com&#x2F;artifact&#x2F;org.springframework.boot&#x2F;spring-boot-starter-web  --&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-actuator&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;!-- https:&#x2F;&#x2F;mvnrepository.com&#x2F;artifact&#x2F;org.springframework.boot&#x2F;spring-boot-devtools --&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-devtools&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;scope&gt;runtime&lt;&#x2F;scope&gt;</span><br><span class="line">            &lt;optional&gt;true&lt;&#x2F;optional&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;!-- https:&#x2F;&#x2F;mvnrepository.com&#x2F;artifact&#x2F;org.projectlombok&#x2F;lombok --&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.projectlombok&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;lombok&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;!-- https:&#x2F;&#x2F;mvnrepository.com&#x2F;artifact&#x2F;org.springframework.boot&#x2F;spring-boot-starter-test --&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-test&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;scope&gt;test&lt;&#x2F;scope&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;junit&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;junit&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">    &lt;&#x2F;dependencies&gt;</span><br><span class="line"></span><br><span class="line">&lt;&#x2F;project&gt;</span><br></pre></td></tr></table></figure></li>
<li><p>写YML</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">server:</span><br><span class="line">  port: 7001</span><br><span class="line">eureka:</span><br><span class="line">  instance:</span><br><span class="line">    hostname: localhost # eureka服务端实例名称</span><br><span class="line">  client:</span><br><span class="line">    #false表示不向注册中心注册自己</span><br><span class="line">    register-with-eureka: false</span><br><span class="line">    #false表示自己就是注册中心，职责是维护服务实例，并不需要去检索服务</span><br><span class="line">    fetch-registry: false</span><br><span class="line">    service-url:</span><br><span class="line">      # 设置与 eureka server交互的地址查询服务和注册服务都需要依赖这个地址</span><br><span class="line">      defaultZone:  http:&#x2F;&#x2F;$&#123;eureka.instance.hostname&#125;:$&#123;server.port&#125;&#x2F;eureka&#x2F;</span><br></pre></td></tr></table></figure>
</li>
<li><p>主启动</p>
<p> <code>@EnableEurekaServer</code>：声明自己是 eureka 的服务端</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">package com.atguitu.springcloud;</span><br><span class="line"></span><br><span class="line">import org.springframework.boot.SpringApplication;</span><br><span class="line">import org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line">import org.springframework.cloud.netflix.eureka.server.EnableEurekaServer;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * @program: cloud2020</span><br><span class="line"> * @description: Eureka主启动类</span><br><span class="line"> * @author: Mr.Wang</span><br><span class="line"> * @create: 2020-08-17-14-21</span><br><span class="line"> *&#x2F;</span><br><span class="line">@SpringBootApplication</span><br><span class="line">@EnableEurekaServer &#x2F;&#x2F;表示这个就是注册中心，等级注册</span><br><span class="line">public class EurekaMain7001 &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        SpringApplication.run(EurekaMain7001.class,args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>测试</p>
<ul>
<li>测试地址:<code>http://localhost:7001</code></li>
<li>结果页面<br><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ghtsvv46ukj31cp0u0guw.jpg" alt=""></li>
</ul>
</li>
</ol>
<h4 id="2-2-2-EurekaClient端cloud-provider-payment8001将注册进EurekaServer成为服务提供者provider，类似尚硅谷学校对外提供授课服务"><a href="#2-2-2-EurekaClient端cloud-provider-payment8001将注册进EurekaServer成为服务提供者provider，类似尚硅谷学校对外提供授课服务" class="headerlink" title="2.2.2 EurekaClient端cloud-provider-payment8001将注册进EurekaServer成为服务提供者provider，类似尚硅谷学校对外提供授课服务"></a>2.2.2 EurekaClient端cloud-provider-payment8001将注册进EurekaServer成为服务提供者provider，类似尚硅谷学校对外提供授课服务</h4><ol>
<li><p>建立<code>cloud-provider-payment8001</code></p>
</li>
<li><p>改POM<br>增加客户端的jar包</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--eureka-client--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.cloud&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-cloud-starter-netflix-eureka-client&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>写YML<br>更改8001的yaml配置文件，增加一下配置</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">eureka:</span><br><span class="line">  client:</span><br><span class="line">    #表示是否将自己注册进EurekaServer默认为true</span><br><span class="line">    register-with-eureka: true</span><br><span class="line">    #是否从EurekaServer抓取已有的注册信息，默认为true。单节点无所谓，集群必须设置为true才能配合ribbon使用 负载均衡</span><br><span class="line">    fetch-registry: false</span><br><span class="line">    service-url:</span><br><span class="line">      # 入住的地址</span><br><span class="line">      defaultZone:  http:&#x2F;&#x2F;localhost:7001&#x2F;eureka</span><br></pre></td></tr></table></figure></li>
<li><p>主启动<br>在主启动上添加<code>@EnableEurekaClient</code>注解，表示这个是客户端</p>
</li>
<li><p>测试</p>
<ul>
<li>先要启动EurekaServer</li>
<li>地址：<a href="http://localhost:7001/" target="_blank" rel="noopener">http://localhost:7001/</a><br><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ghttlxh4fwj31ft0u0qce.jpg" alt=""></li>
<li>微服务注册名配置说明<br><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ghttmktrtcj316q0lo7kj.jpg" alt=""></li>
</ul>
</li>
<li><p>自我保护机制</p>
</li>
</ol>
<h4 id="2-2-3-EurekaClient端cloud-consumer-order80将注册进EurekaServer成为服务消费者consumer-类似来尚硅谷上课消费的各位同学"><a href="#2-2-3-EurekaClient端cloud-consumer-order80将注册进EurekaServer成为服务消费者consumer-类似来尚硅谷上课消费的各位同学" class="headerlink" title="2.2.3 EurekaClient端cloud-consumer-order80将注册进EurekaServer成为服务消费者consumer,类似来尚硅谷上课消费的各位同学"></a>2.2.3 EurekaClient端cloud-consumer-order80将注册进EurekaServer成为服务消费者consumer,类似来尚硅谷上课消费的各位同学</h4><ol>
<li>修改<code>cloud-consumer-order80</code>模块</li>
<li>POM文件修改，同8001模块相同</li>
<li>写YML</li>
<li>主启动，同8001模块相同</li>
<li>测试<ul>
<li>先要启动EurekaServer,7001服务</li>
<li>在要启动服务提供者provider,8001服务</li>
<li>eureka服务器<br><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ghtu58jt0rj31c70u0dqi.jpg" alt=""></li>
<li><a href="http://localhost/consumer/payment/get/31" target="_blank" rel="noopener">http://localhost/consumer/payment/get/31</a></li>
</ul>
</li>
</ol>
<h3 id="2-3-集群Eureka构建步骤"><a href="#2-3-集群Eureka构建步骤" class="headerlink" title="2.3 集群Eureka构建步骤"></a>2.3 集群Eureka构建步骤</h3><h4 id="2-3-1-集群原理说明"><a href="#2-3-1-集群原理说明" class="headerlink" title="2.3.1 集群原理说明"></a>2.3.1 集群原理说明</h4><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ghtuonapuxj31da0fan8m.jpg" alt=""><br>微服务RPC远程服务调用最核心是什么：<br>高可用，如果注册中心只有一个，出了故障就会导致整个服务环境不可用<br>解决方法：搭建Eureka注册中心集群，实现负载均衡+故障排错<br><strong><em>集群注册的原理：</em></strong>互相注册，相互守望<br><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ghtusj1w51j30k80a4t9f.jpg" alt=""></p>
<h4 id="2-3-2-EurekaServer集群环境构建步骤"><a href="#2-3-2-EurekaServer集群环境构建步骤" class="headerlink" title="2.3.2 EurekaServer集群环境构建步骤"></a>2.3.2 EurekaServer集群环境构建步骤</h4><ol>
<li><p>参考<code>cloud-eureka-server7001</code>新建<code>cloud-eureka-server7002</code></p>
</li>
<li><p>改POM</p>
</li>
<li><p>修改映射配置<br>在系统的hosts文件中添加一下配置</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1  eureka7001.com</span><br><span class="line">127.0.0.1  eureka7002.com</span><br></pre></td></tr></table></figure></li>
<li><p>写YML(以前单机)<br> <del>单机的看以前的配置</del></p>
<ul>
<li><p>7001的yml配置文件</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">server:</span><br><span class="line">  port: 7001</span><br><span class="line">eureka:</span><br><span class="line">  instance:</span><br><span class="line">    hostname: 127.0.0.1 # eureka服务端实例名称，集群名字要不同有区分</span><br><span class="line">  client:</span><br><span class="line">    #false表示不向注册中心注册自己</span><br><span class="line">    register-with-eureka: false</span><br><span class="line">    #false表示自己就是注册中心，职责是维护服务实例，并不需要去检索服务</span><br><span class="line">    fetch-registry: false</span><br><span class="line">    service-url:</span><br><span class="line">      # 设置与 eureka server交互的地址查询服务和注册服务都需要依赖这个地址</span><br><span class="line">      defaultZone:  http:&#x2F;&#x2F;localhost:7002&#x2F;eureka&#x2F;</span><br></pre></td></tr></table></figure></li>
<li><p>7002的yml配置文件</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">server:</span><br><span class="line">  port: 7002</span><br><span class="line">eureka:</span><br><span class="line">  instance:</span><br><span class="line">    hostname: localhost</span><br><span class="line">  client:</span><br><span class="line">    #false表示不向注册中心注册自己</span><br><span class="line">    register-with-eureka: false</span><br><span class="line">    #false表示自己就是注册中心，职责是维护服务实例，并不需要去检索服务</span><br><span class="line">    fetch-registry: false</span><br><span class="line">    service-url:</span><br><span class="line">      # 设置与 eureka server交互的地址查询服务和注册服务都需要依赖这个地址</span><br><span class="line">      defaultZone:  http:&#x2F;&#x2F;127.0.0.1:7001&#x2F;eureka&#x2F;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>主启动</p>
</li>
</ol>
<h4 id="2-3-3-将支付服务8001微服务发布到上面2台Eureka集群配置中"><a href="#2-3-3-将支付服务8001微服务发布到上面2台Eureka集群配置中" class="headerlink" title="2.3.3 将支付服务8001微服务发布到上面2台Eureka集群配置中"></a>2.3.3 将支付服务8001微服务发布到上面2台Eureka集群配置中</h4><p>yml配置文件的修改<br><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ghtx03t8v2j31ji0kukjl.jpg" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">server:</span><br><span class="line">  port: 8001</span><br><span class="line"></span><br><span class="line">spring:</span><br><span class="line">  application:</span><br><span class="line">    name: cloud-payment-service</span><br><span class="line">  datasource:</span><br><span class="line">    driver-class-name: com.mysql.cj.jdbc.Driver</span><br><span class="line">    # serverTimezone&#x3D;CTT&amp;useUnicode&#x3D;true&amp;characterEncoding&#x3D;utf-8&amp;allowMultiQueries&#x3D;true</span><br><span class="line">    url: jdbc:mysql:&#x2F;&#x2F;111.229.203.5:3306&#x2F;db2019?serverTimezone&#x3D;CTT&amp;useUnicode&#x3D;true&amp;characterEncoding&#x3D;utf-8&amp;useSSL&#x3D;false</span><br><span class="line">    username: weaver</span><br><span class="line">    password: 192612</span><br><span class="line">    type: com.alibaba.druid.pool.DruidDataSource</span><br><span class="line"></span><br><span class="line">mybatis:</span><br><span class="line">  mapperLocations: classpath:mapper&#x2F;*.xml</span><br><span class="line">  type-aliases-package: com.atguigu.springcloud.entities</span><br><span class="line"></span><br><span class="line">eureka:</span><br><span class="line">  client:</span><br><span class="line">    #表示是否将自己注册进EurekaServer默认为true</span><br><span class="line">    register-with-eureka: true</span><br><span class="line">    #是否从EurekaServer抓取已有的注册信息，默认为true。单节点无所谓，集群必须设置为true才能配合ribbon使用 负载均衡</span><br><span class="line">    fetch-registry: false</span><br><span class="line">    service-url:</span><br><span class="line">      # 入住的地址</span><br><span class="line">      #defaultZone:  http:&#x2F;&#x2F;localhost:7001&#x2F;eureka</span><br><span class="line">      # 集群的配置</span><br><span class="line">      defaultZone:  http:&#x2F;&#x2F;localhost:7001&#x2F;eureka,http:&#x2F;&#x2F;localhost:7002&#x2F;eureka</span><br></pre></td></tr></table></figure>
<h4 id="2-3-4-将订单服务80微服务发布到上面2台Eureka集群配置中"><a href="#2-3-4-将订单服务80微服务发布到上面2台Eureka集群配置中" class="headerlink" title="2.3.4 将订单服务80微服务发布到上面2台Eureka集群配置中"></a>2.3.4 将订单服务80微服务发布到上面2台Eureka集群配置中</h4><p>修改配置同<strong><em>2.3.3</em></strong></p>
<h4 id="2-3-5-测试01"><a href="#2-3-5-测试01" class="headerlink" title="2.3.5 测试01"></a>2.3.5 测试01</h4><ol>
<li>先要启动EurekaServer，7001/7002服务</li>
<li>再要启动服务提供者provider，8001服务</li>
<li>再要启动消费者，80</li>
<li><a href="http://localhost/consumer/payment/get/31" target="_blank" rel="noopener">http://localhost/consumer/payment/get/31</a></li>
</ol>
<h4 id="2-3-6-支付服务提供者8001集群环境构建"><a href="#2-3-6-支付服务提供者8001集群环境构建" class="headerlink" title="2.3.6 支付服务提供者8001集群环境构建"></a>2.3.6 支付服务提供者8001集群环境构建</h4><ol>
<li><p>参考<code>cloud-provider-payment8001</code>新建<code>cloud-provider-payment8002</code></p>
</li>
<li><p>改POM<br> 同8001的POM文件一致</p>
</li>
<li><p>写YML</p>
<ul>
<li>7001</li>
<li>7002</li>
</ul>
</li>
<li><p>主启动类</p>
</li>
<li><p>修改8001/8002的Controller</p>
<ul>
<li><p>8001<br><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ghu3xu9igpj31je0qc1ky.jpg" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 在各个方法中调用 serverPort 查看端口号</span><br><span class="line">@Value(&quot;$&#123;server.port&#125;&quot;)</span><br><span class="line">private String serverPort;</span><br></pre></td></tr></table></figure></li>
<li><p>8002<br>配置方法同8001</p>
</li>
</ul>
</li>
</ol>
<h4 id="2-3-7-负载均衡"><a href="#2-3-7-负载均衡" class="headerlink" title="2.3.7 负载均衡"></a>2.3.7 负载均衡</h4><ol>
<li>bug<br> 订单服务访问地址不能写死</li>
<li>使用<code>@LoadBalance</code>注解赋予RestTemplate负载均衡的能力<ul>
<li>在之前单机版中写死为8001，但是集群后有8001与8002，</li>
<li>进入 <a href="http://eureka7001.com:7001/" target="_blank" rel="noopener">http://eureka7001.com:7001/</a> 查看 8001 与 8002 对应的名称 application</li>
<li>将 PAYMENT_URL 改为 http+application 名 :<a href="http://CLOUD-PAYMENT-SERVICE" target="_blank" rel="noopener">http://CLOUD-PAYMENT-SERVICE</a></li>
<li>此时未开启负载均衡不能访问页面：将80端口下的配置类ApplicationContextConfig 下生成的 RestTemplate 的bean方法上添加注解 @LoadBalanced</li>
<li><a href="http://localhost/consumer/payment/get/34" target="_blank" rel="noopener">http://localhost/consumer/payment/get/34</a> 访问查看端口号，可以看到在8001与8002之间来回切换</li>
<li>在客户端的yml配置中需要开启对负载均衡的支持<br>  <img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ghu41i0w8gj31ok0qm7wi.jpg" alt=""></li>
</ul>
</li>
<li>ApplicationContextBean<br> 提前说下Ribbon的负载均衡功能</li>
</ol>
<h4 id="2-3-8-测试02"><a href="#2-3-8-测试02" class="headerlink" title="2.3.8 测试02"></a>2.3.8 测试02</h4><ol>
<li>先要启动EurekaServer，7001/7002服务</li>
<li>再要启动服务提供者provider，8001/8002服务</li>
<li><a href="http://localhost/consumer/payment/get/31" target="_blank" rel="noopener">http://localhost/consumer/payment/get/31</a></li>
<li>结果<ul>
<li>负载均衡效果达到</li>
<li>8001/8002端口交替出现</li>
</ul>
</li>
<li>Ribbon和Eureka整合后Consumer可以直接调用服务而不用再关心地址和端口号，且该服务还有负载功能了</li>
</ol>
<h3 id="2-4-actuator微服务信息完善"><a href="#2-4-actuator微服务信息完善" class="headerlink" title="2.4 actuator微服务信息完善"></a>2.4 actuator微服务信息完善</h3><ol>
<li><p>主机名称：服务名称修改</p>
<ul>
<li><p>当前问题<br><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ghu4act4d8j31jf0u0wmb.jpg" alt=""></p>
</li>
<li><p>修改cloud-provider-payment8001</p>
<ul>
<li><p>修改部分</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">instance:</span><br><span class="line">      instance-id: payment8002  # 自定义主机名</span><br><span class="line">      #prefer-ip-address: true # 设置暴露ip地址</span><br></pre></td></tr></table></figure>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ghu4fqizzkj31ne0p01ky.jpg" alt=""></p>
</li>
<li><p>完整内容</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">server:</span><br><span class="line">  port: 8002</span><br><span class="line"></span><br><span class="line">spring:</span><br><span class="line">  application:</span><br><span class="line">    #s</span><br><span class="line">    name: cloud-payment-service</span><br><span class="line">  datasource:</span><br><span class="line">    driver-class-name: com.mysql.cj.jdbc.Driver</span><br><span class="line">    # serverTimezone&#x3D;CTT&amp;useUnicode&#x3D;true&amp;characterEncoding&#x3D;utf-8&amp;allowMultiQueries&#x3D;true</span><br><span class="line">    url: jdbc:mysql:&#x2F;&#x2F;111.229.203.5:3306&#x2F;db2019?serverTimezone&#x3D;CTT&amp;useUnicode&#x3D;true&amp;characterEncoding&#x3D;utf-8&amp;useSSL&#x3D;false</span><br><span class="line">    username: weaver</span><br><span class="line">    password: 192612</span><br><span class="line">    type: com.alibaba.druid.pool.DruidDataSource</span><br><span class="line"></span><br><span class="line">mybatis:</span><br><span class="line">  mapperLocations: classpath:mapper&#x2F;*.xml</span><br><span class="line">  type-aliases-package: com.atguigu.springcloud.entities</span><br><span class="line"></span><br><span class="line">eureka:</span><br><span class="line">  client:</span><br><span class="line">    #表示是否将自己注册进EurekaServer默认为true</span><br><span class="line">    register-with-eureka: true</span><br><span class="line">    #是否从EurekaServer抓取已有的注册信息，默认为true。单节点无所谓，集群必须设置为true才能配合ribbon使用 负载均衡</span><br><span class="line">    fetch-registry: false</span><br><span class="line">    service-url:</span><br><span class="line">      # 入住的地址</span><br><span class="line">      #defaultZone:  http:&#x2F;&#x2F;localhost:7001&#x2F;eureka</span><br><span class="line">      # 集群的配置</span><br><span class="line">      defaultZone:  http:&#x2F;&#x2F;localhost:7001&#x2F;eureka,http:&#x2F;&#x2F;localhost:7002&#x2F;eureka</span><br><span class="line">  instance:</span><br><span class="line">    instance-id: payment8002  # 自定义主机名</span><br><span class="line">    prefer-ip-address: true # 设置暴露ip地址</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>修改之后<br><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ghu4ik12bxj31qo0u0aif.jpg" alt=""></p>
</li>
</ul>
</li>
<li><p>访问信息有ip信息提示</p>
<ul>
<li>当前问题：没有ip提示</li>
<li>修改修改cloud-provider-payment8001<ul>
<li>修改部分<br>见上面截图部分</li>
<li>完整内容<br>见上面截图部分</li>
</ul>
</li>
<li>修改之后</li>
</ul>
</li>
</ol>
<h3 id="2-5-服务发现Discovery"><a href="#2-5-服务发现Discovery" class="headerlink" title="2.5 服务发现Discovery"></a>2.5 服务发现Discovery</h3><ol>
<li><p>对于注册进eureka里面的微服务，可以通过服务发现来获得该服务的信息</p>
</li>
<li><p>修改cloud-provider-payment8001的Controller<br> <strong><em>目前存在一个问题，返回的discoveryClient中不能像视频中一样返回带有服务名称的json串，目前返回的为空</em></strong></p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">@Resource</span><br><span class="line">    private DiscoveryClient discoveryClient;</span><br><span class="line"></span><br><span class="line">    @GetMapping(&quot;&#x2F;payment&#x2F;discovery&quot;)</span><br><span class="line">    public DiscoveryClient discovery()&#123;</span><br><span class="line">        &#x2F;&#x2F; 得到所有服务名</span><br><span class="line">        List&lt;String&gt; services &#x3D; discoveryClient.getServices();</span><br><span class="line">        services.forEach(ele-&gt;&#123;</span><br><span class="line">            log.info(&quot;***service***&quot;+ele);</span><br><span class="line">        &#125;);</span><br><span class="line">        &#x2F;&#x2F; 得到服务名对应的信息</span><br><span class="line">        List&lt;ServiceInstance&gt; instances &#x3D; discoveryClient.getInstances(&quot;CLOUD-PAYMENT-SERVICE&quot;);</span><br><span class="line">        instances.forEach(ele-&gt;&#123;</span><br><span class="line">            log.info(ele.getServiceId()+&quot;\t&quot;+ele.getHost()+&quot;\t&quot;+ele.getPort()+&quot;\t&quot;+ele.getUri());</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        return discoveryClient;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li>
<li><p>8001主启动类<br> 8001 主类添加注解 <code>@EnableDiscoveryClient</code></p>
</li>
<li><p>自测</p>
<ul>
<li>先要启动EurekaServer，7001/7002服务</li>
<li>再启动8001主启动类，需要稍等一会</li>
<li><a href="http://localhost:8001/payment/discovery" target="_blank" rel="noopener">http://localhost:8001/payment/discovery</a></li>
</ul>
</li>
</ol>
<h3 id="2-6-Eureka自我保护"><a href="#2-6-Eureka自我保护" class="headerlink" title="2.6 Eureka自我保护"></a>2.6 Eureka自我保护</h3><ol>
<li><p>故障现象<br><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ghuvpxtwcaj31ew0ianea.jpg" alt=""></p>
</li>
<li><p>导致原因<br>一句话：某一时刻某一个微服务不可用了，Eureka不会立即清理，依旧会对该微服务的信息进行保存。属于CAP里面的AP分支</p>
<ol>
<li>为什么会产生自我保护？<br>为了防止 EurekaClient 可以正常运行，但是在 EurekaServer 网络不通的情况下，EurekaServer 不会立刻将 EurekaClient 服务剔除。</li>
<li>什么是自我保护模式？<br>默认情况下，EurekaServer在一定时间内没有接收到某个微服务实例的心跳，EurekaServer将会注销该实例（默认90s），但是当网络分区故障发生，微服务与 EurekaServer 之间无法正常通信，以上行为就非常危险。当EurekaServer节点在短时间内丢失过多客户端时，那么这个节点就会进入自我保护模式。<br><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ghuvxf920dj30vu0hkh1b.jpg" alt=""></li>
</ol>
</li>
<li><p>怎么禁止自我保护(一般生产环境中不会禁止自我保护)</p>
<ul>
<li><p>注册中心eureakeServer端7001</p>
<ol>
<li><p>出厂默认，自我保护机制是开启的<code>eureka.server.enable-self-preservation = true</code></p>
</li>
<li><p>使用<code>eureka.server.enable-self-preservation = false</code>可以禁用自我保护模式</p>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ghuy88tgopj318o0iyb29.jpg" alt=""></p>
</li>
<li><p>关闭效果</p>
</li>
<li><p>在eurekaServer端7001处设置关闭自我保护机制</p>
</li>
</ol>
</li>
<li><p>生产者客户端eureakeClient端8001</p>
<ul>
<li><p><code>eureka.instance.lease-renewal-interval-in-seconds=30 eureka.instance.lease-expiration-duration-in-seconds=90</code></p>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ghuy8sj2ooj31mw0nsx6p.jpg" alt=""></p>
</li>
<li><p>测试</p>
<ul>
<li>7001和8001都配置完成</li>
<li>先启动7001在启动8001</li>
<li>先关闭8001 马上被删除</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ol>
<h2 id="3-Zookeeper服务注册与发现"><a href="#3-Zookeeper服务注册与发现" class="headerlink" title="3. Zookeeper服务注册与发现"></a>3. Zookeeper服务注册与发现</h2><h3 id="3-1-Eureka停止更新了你怎么办"><a href="#3-1-Eureka停止更新了你怎么办" class="headerlink" title="3.1 Eureka停止更新了你怎么办"></a>3.1 Eureka停止更新了你怎么办</h3><p><a href="https://github.com/Netflix/eureka/wiki" target="_blank" rel="noopener">https://github.com/Netflix/eureka/wiki</a></p>
<h3 id="3-2-SpringCloud整合Zookeeper代替Eureka"><a href="#3-2-SpringCloud整合Zookeeper代替Eureka" class="headerlink" title="3.2 SpringCloud整合Zookeeper代替Eureka"></a>3.2 SpringCloud整合Zookeeper代替Eureka</h3><h4 id="3-2-1-注册中心Zookeeper"><a href="#3-2-1-注册中心Zookeeper" class="headerlink" title="3.2.1 注册中心Zookeeper"></a>3.2.1 注册中心Zookeeper</h4><ol>
<li>zookeeper是一个分布式协调工具，可以实现注册中心功能</li>
<li>关闭Linux服务器防火墙后启动zookeeper服务器</li>
<li>zookeeper服务器取代Eureka服务器，zk作为服务注册中心</li>
</ol>
<h4 id="3-2-2-服务提供者"><a href="#3-2-2-服务提供者" class="headerlink" title="3.2.2 服务提供者"></a>3.2.2 服务提供者</h4><ol>
<li><p>新建<code>cloud-provider-payment8004</code></p>
</li>
<li><p>POM</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;project xmlns&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0&quot;</span><br><span class="line">         xmlns:xsi&#x3D;&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;2001&#x2F;XMLSchema-instance&quot;</span><br><span class="line">         xsi:schemaLocation&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0 http:&#x2F;&#x2F;maven.apache.org&#x2F;xsd&#x2F;maven-4.0.0.xsd&quot;&gt;</span><br><span class="line">    &lt;parent&gt;</span><br><span class="line">        &lt;artifactId&gt;cloud2020&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;groupId&gt;com.atguigu.springcloud&lt;&#x2F;groupId&gt;</span><br><span class="line">        &lt;version&gt;1.0-SNAPSHOT&lt;&#x2F;version&gt;</span><br><span class="line">    &lt;&#x2F;parent&gt;</span><br><span class="line">    &lt;modelVersion&gt;4.0.0&lt;&#x2F;modelVersion&gt;</span><br><span class="line"></span><br><span class="line">    &lt;artifactId&gt;cloud-consumerzk-order80&lt;&#x2F;artifactId&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;&#x2F;project&gt;</span><br></pre></td></tr></table></figure></li>
<li><p>YML</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># 8004表示注册到zookeeper服务器的支付服务提供端口号</span><br><span class="line">server:</span><br><span class="line">  port: 8004</span><br><span class="line"></span><br><span class="line"># 服务别名----注册zookeeper到注册中心名称</span><br><span class="line">spring:</span><br><span class="line">  application:</span><br><span class="line">    name: cloud-provider-payment</span><br><span class="line">  cloud:</span><br><span class="line">    zookeeper:</span><br><span class="line">      connect-string: 49.235.24.12:2181</span><br></pre></td></tr></table></figure></li>
<li><p>主启动类</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">package com.atguigu.springcloud;</span><br><span class="line"></span><br><span class="line">import org.springframework.boot.SpringApplication;</span><br><span class="line">import org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line">import org.springframework.cloud.client.discovery.EnableDiscoveryClient;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * @program: cloud2020</span><br><span class="line"> * @description: zk服务端启动类</span><br><span class="line"> * @author: Mr.Wang</span><br><span class="line"> * @create: 2020-08-18-17-20</span><br><span class="line"> *&#x2F;</span><br><span class="line">@SpringBootApplication</span><br><span class="line">&#x2F;&#x2F;该注解用于向使用consul或者zookeeper作为注册中心时注册服务</span><br><span class="line">@EnableDiscoveryClient</span><br><span class="line">public class PaymentMain8004 &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        SpringApplication.run(PaymentMain8004.class,args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>Controller</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">package com.atguigu.springcloud.controller;</span><br><span class="line"></span><br><span class="line">import lombok.extern.slf4j.Slf4j;</span><br><span class="line">import org.springframework.beans.factory.annotation.Value;</span><br><span class="line">import org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line">import org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line">import java.util.UUID;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * @program: cloud2020</span><br><span class="line"> * @description: 控制层</span><br><span class="line"> * @author: Mr.Wang</span><br><span class="line"> * @create: 2020-08-18-20-32</span><br><span class="line"> *&#x2F;</span><br><span class="line">@RestController</span><br><span class="line">@Slf4j</span><br><span class="line">public class PaymentController &#123;</span><br><span class="line">    @Value(&quot;$&#123;server.port&#125;&quot;)</span><br><span class="line">    private String serverPort;</span><br><span class="line"></span><br><span class="line">    @GetMapping(value &#x3D; &quot;&#x2F;payment&#x2F;zk&quot;)</span><br><span class="line">    public String paymentzk()&#123;</span><br><span class="line">        return &quot;springcloud with zookeeper:&quot;+serverPort+&quot;\t&quot;+ UUID.randomUUID().toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>启动8004注册进zookeeper</p>
<ul>
<li>启动后的问题</li>
<li>解决zookeeper半分jar包冲突</li>
<li>排除zk冲突后的新POM</li>
</ul>
</li>
<li><p>验证测试<br><a href="http://localhost:8004/payment/zk" target="_blank" rel="noopener">http://localhost:8004/payment/zk</a></p>
</li>
<li><p>验证测试2<br><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ghv9w26r5jj31ei0f0wqm.jpg" alt=""></p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># 获取服务名</span><br><span class="line">[zk: localhost:2181(CONNECTED) 0] ls &#x2F;services</span><br><span class="line">[cloud-provider-payment]</span><br><span class="line"># 获取流水号</span><br><span class="line">[zk: localhost:2181(CONNECTED) 1] ls &#x2F;services&#x2F;cloud-provider-payment</span><br><span class="line">[efc76371-522d-4d5d-8f56-f8fe4deb7a47]</span><br><span class="line"># 获取详细信息</span><br><span class="line">[zk: localhost:2181(CONNECTED) 2] get &#x2F;services&#x2F;cloud-provider-payment&#x2F;efc76371-522d-4d5d-8f56-f8fe4deb7a47</span><br><span class="line">&#123;&quot;name&quot;:&quot;cloud-provider-payment&quot;,&quot;id&quot;:&quot;efc76371-522d-4d5d-8f56-f8fe4deb7a47&quot;,&quot;address&quot;:&quot;WINDOWS-N0GUAG7&quot;,&quot;port&quot;:8004,&quot;sslPort&quot;:null,&quot;payload&quot;:&#123;&quot;@class&quot;:&quot;org.springframework.cloud.zookeeper.discovery.ZookeeperInstance&quot;,&quot;id&quot;:&quot;application-1&quot;,&quot;name&quot;:&quot;cloud-provider-payment&quot;,&quot;metadata&quot;:&#123;&#125;&#125;,&quot;registrationTimeUTC&quot;:1590232919360,&quot;serviceType&quot;:&quot;DYNAMIC&quot;,&quot;uriSpec&quot;:&#123;&quot;parts&quot;:[&#123;&quot;value&quot;:&quot;scheme&quot;,&quot;variable&quot;:true&#125;,&#123;&quot;value&quot;:&quot;:&#x2F;&#x2F;&quot;,&quot;variable&quot;:false&#125;,&#123;&quot;value&quot;:&quot;address&quot;,&quot;variable&quot;:true&#125;,&#123;&quot;value&quot;:&quot;:&quot;,&quot;variable&quot;:false&#125;,&#123;&quot;value&quot;:&quot;port&quot;,&quot;variable&quot;:true&#125;]&#125;&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>思考</p>
<ul>
<li><p>服务节点是临时还是持久</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[zk: localhost:2181(CONNECTED) 18] ls &#x2F;services&#x2F;cloud-provider-payment</span><br><span class="line">[efc76371-522d-4d5d-8f56-f8fe4deb7a47]</span><br><span class="line">[zk: localhost:2181(CONNECTED) 19] ls &#x2F;services&#x2F;cloud-provider-payment</span><br><span class="line">[efc76371-522d-4d5d-8f56-f8fe4deb7a47]</span><br><span class="line">[zk: localhost:2181(CONNECTED) 20] ls &#x2F;services&#x2F;cloud-provider-payment</span><br><span class="line">[efc76371-522d-4d5d-8f56-f8fe4deb7a47]</span><br><span class="line">[zk: localhost:2181(CONNECTED) 21] ls &#x2F;services&#x2F;cloud-provider-payment</span><br><span class="line">[]</span><br><span class="line">[zk: localhost:2181(CONNECTED) 22]</span><br></pre></td></tr></table></figure>

</li>
</ul>
</li>
</ol>
<h4 id="3-2-3-服务消费者"><a href="#3-2-3-服务消费者" class="headerlink" title="3.2.3 服务消费者"></a>3.2.3 服务消费者</h4><ol>
<li><p>新建<code>cloud-consumerzk-order80</code></p>
</li>
<li><p>POM<br>同zookeeper服务端配置(8004)相同</p>
</li>
<li><p>YML<br>同zookeeper服务端配置(8004)相同</p>
</li>
<li><p>主启动<br>同zookeeper服务端配置(8004)相同</p>
</li>
<li><p>业务类</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">package com.atguigu.springcloud.controller;</span><br><span class="line"></span><br><span class="line">import lombok.extern.slf4j.Slf4j;</span><br><span class="line">import org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line">import org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line">import org.springframework.web.bind.annotation.RestController;</span><br><span class="line">import org.springframework.web.client.RestTemplate;</span><br><span class="line"></span><br><span class="line">import javax.annotation.Resource;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * @program: cloud2020</span><br><span class="line"> * @description: 控制层</span><br><span class="line"> * @author: Mr.Wang</span><br><span class="line"> * @create: 2020-08-19-09-16</span><br><span class="line"> *&#x2F;</span><br><span class="line">@RestController</span><br><span class="line">@Slf4j</span><br><span class="line">public class ConsumerController &#123;</span><br><span class="line"></span><br><span class="line">    private static final String INVOKE_URL &#x3D; &quot;http:&#x2F;&#x2F;cloud-provider-payment&quot;;</span><br><span class="line">    @Autowired</span><br><span class="line">    private RestTemplate restTemplate;</span><br><span class="line"></span><br><span class="line">    @GetMapping(&quot;&#x2F;consumer&#x2F;payment&#x2F;zk&quot;)</span><br><span class="line">    public String paymentInfo()&#123;</span><br><span class="line">        String result &#x3D; restTemplate.getForObject(INVOKE_URL + &quot;&#x2F;payment&#x2F;zk&quot;, String.class);</span><br><span class="line">        return result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>启动8004注册进zookeeper</p>
</li>
<li><p>验证测试：<a href="http://localhost:8004/payment/zk" target="_blank" rel="noopener">http://localhost:8004/payment/zk</a></p>
</li>
<li><p>访问测试地址：<a href="http://localhost/consumer/payment/zk" target="_blank" rel="noopener">http://localhost/consumer/payment/zk</a></p>
</li>
</ol>
<h2 id="4-Consul服务注册与发现"><a href="#4-Consul服务注册与发现" class="headerlink" title="4. Consul服务注册与发现"></a>4. Consul服务注册与发现</h2><h3 id="4-1-Consul简介"><a href="#4-1-Consul简介" class="headerlink" title="4.1 Consul简介"></a>4.1 Consul简介</h3><ol>
<li><p>是什么：<a href="https://www.consul.io/intro/index.html" target="_blank" rel="noopener">https://www.consul.io/intro/index.html</a><br>Consul是一种服务网格解决方案，提供具有服务发现，配置和分段功能的全功能控制平面。这些功能中的每一个都可以根据需要单独使用，也可以一起使用以构建完整的服务网格。Consul需要一个数据平面，并支持代理和本机集成模型。Consul附带了一个简单的内置代理，因此一切都可以直接使用，还支持Envoy等第三方代理集成。</p>
</li>
<li><p>能干嘛</p>
<ul>
<li><p>服务发现：Consul的客户端可以注册服务，例如 api或mysql，其他客户端可以使用Consul来发现给定服务的提供者。使用DNS或HTTP，应用程序可以轻松找到它们依赖的服务。</p>
</li>
<li><p>运行状况检查：领事客户端可以提供任何数量的运行状况检查，这些检查可以与给定服务（“ Web服务器返回200 OK”）或与本地节点（“内存利用率低于90％”）相关联。操作员可以使用此信息来监视群集的运行状况，服务发现组件可以使用此信息将流量路由到运行状况不佳的主机之外。</p>
</li>
<li><p>KV商店：应用程序可以将Consul的分层键/值存储用于多种目的，包括动态配置，功能标记，协调，领导者选举等。简单的HTTP API使其易于使用。</p>
</li>
<li><p>安全的服务通信：领事可以为服务生成并分发TLS证书，以建立相互TLS连接。 意图 可用于定义允许哪些服务进行通信。可以使用可以实时更改的意图轻松管理服务分段，而不必使用复杂的网络拓扑和静态防火墙规则。</p>
</li>
<li><p>多数据中心：Consul开箱即用地支持多个数据中心。这意味着Consul的用户不必担心会构建其他抽象层以扩展到多个区域。</p>
</li>
</ul>
</li>
<li><p>去哪下：<a href="https://www.consul.io/downloads.html" target="_blank" rel="noopener">https://www.consul.io/downloads.html</a></p>
</li>
<li><p>怎么玩：<a href="https://www.springcloud.cc/spring-cloud-consul.html" target="_blank" rel="noopener">https://www.springcloud.cc/spring-cloud-consul.html</a></p>
</li>
</ol>
<h3 id="4-2-安装并运行Consul"><a href="#4-2-安装并运行Consul" class="headerlink" title="4.2 安装并运行Consul"></a>4.2 安装并运行Consul</h3><ol>
<li>官网安装说明:<a href="https://learn.hashicorp.com/consul/getting-started/install.html" target="_blank" rel="noopener">https://learn.hashicorp.com/consul/getting-started/install.html</a></li>
<li>下载完成后只有一个consul.exe文件，硬盘路径下双击运行，查看版本信息</li>
<li>使用开发模式启动</li>
</ol>
<hr>
<ol>
<li>将下载的exe文件双击即可安装</li>
<li>在 exe ==文件的目录==下打开黑窗口</li>
<li>输入 consul –version 检测是否安装成功</li>
<li>启动服务：consul agent -dev</li>
<li>通过 <a href="http://localhost:8500/" target="_blank" rel="noopener">http://localhost:8500/</a> 访问web界面<br><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ghvw7x5oo0j31fz0u0qba.jpg" alt=""></li>
</ol>
<h3 id="4-3-服务提供者"><a href="#4-3-服务提供者" class="headerlink" title="4.3 服务提供者"></a>4.3 服务提供者</h3><ol>
<li><p>新建Module支付服务provider8006<code>cloud-providerconsul-payment8006</code></p>
</li>
<li><p>POM</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;project xmlns&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0&quot;</span><br><span class="line">         xmlns:xsi&#x3D;&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;2001&#x2F;XMLSchema-instance&quot;</span><br><span class="line">         xsi:schemaLocation&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0 http:&#x2F;&#x2F;maven.apache.org&#x2F;xsd&#x2F;maven-4.0.0.xsd&quot;&gt;</span><br><span class="line">    &lt;parent&gt;</span><br><span class="line">        &lt;artifactId&gt;cloud2020&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;groupId&gt;com.atguigu.springcloud&lt;&#x2F;groupId&gt;</span><br><span class="line">        &lt;version&gt;1.0-SNAPSHOT&lt;&#x2F;version&gt;</span><br><span class="line">    &lt;&#x2F;parent&gt;</span><br><span class="line">    &lt;modelVersion&gt;4.0.0&lt;&#x2F;modelVersion&gt;</span><br><span class="line"></span><br><span class="line">    &lt;artifactId&gt;cloud-providerconsul-payment8006&lt;&#x2F;artifactId&gt;</span><br><span class="line"></span><br><span class="line">    &lt;dependencies&gt;</span><br><span class="line">        &lt;!-- https:&#x2F;&#x2F;mvnrepository.com&#x2F;artifact&#x2F;org.springframework.cloud&#x2F;spring-cloud-starter-consul-discovery --&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.cloud&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-cloud-starter-consul-discovery&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;com.atguigu.springcloud&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;cloud-api-commons&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;version&gt;1.0-SNAPSHOT&lt;&#x2F;version&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;!-- https:&#x2F;&#x2F;mvnrepository.com&#x2F;artifact&#x2F;org.springframework.boot&#x2F;spring-boot-starter-web --&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-web&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;!-- https:&#x2F;&#x2F;mvnrepository.com&#x2F;artifact&#x2F;org.springframework.boot&#x2F;spring-boot-starter-web --&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-actuator&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;!-- https:&#x2F;&#x2F;mvnrepository.com&#x2F;artifact&#x2F;org.springframework.boot&#x2F;spring-boot-devtools --&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-devtools&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;scope&gt;runtime&lt;&#x2F;scope&gt;</span><br><span class="line">            &lt;optional&gt;true&lt;&#x2F;optional&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;!-- https:&#x2F;&#x2F;mvnrepository.com&#x2F;artifact&#x2F;org.projectlombok&#x2F;lombok --&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.projectlombok&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;lombok&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;optional&gt;true&lt;&#x2F;optional&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;!-- https:&#x2F;&#x2F;mvnrepository.com&#x2F;artifact&#x2F;org.springframework.boot&#x2F;spring-boot-starter-test --&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-test&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;scope&gt;test&lt;&#x2F;scope&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">    &lt;&#x2F;dependencies&gt;</span><br><span class="line"></span><br><span class="line">&lt;&#x2F;project&gt;</span><br></pre></td></tr></table></figure></li>
<li><p>YML</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">server:</span><br><span class="line">  port: 8006</span><br><span class="line">spring:</span><br><span class="line">  application:</span><br><span class="line">    name: consul-provider-payment</span><br><span class="line">  cloud:</span><br><span class="line">    consul:</span><br><span class="line">      discovery:</span><br><span class="line">        service-name: $&#123;spring.application.name&#125;</span><br><span class="line">      host: 111.229.203.5</span><br><span class="line">      port: 8500</span><br></pre></td></tr></table></figure></li>
<li><p>主启动类</p>
</li>
<li><p>业务类Controller</p>
</li>
<li><p>验证测试：<a href="http://localhost:8006/payment/consul" target="_blank" rel="noopener">http://localhost:8006/payment/consul</a></p>
</li>
</ol>
<h3 id="4-4-服务消费者"><a href="#4-4-服务消费者" class="headerlink" title="4.4 服务消费者"></a>4.4 服务消费者</h3><ol>
<li><p>pom</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;project xmlns&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0&quot;</span><br><span class="line">         xmlns:xsi&#x3D;&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;2001&#x2F;XMLSchema-instance&quot;</span><br><span class="line">         xsi:schemaLocation&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0 http:&#x2F;&#x2F;maven.apache.org&#x2F;xsd&#x2F;maven-4.0.0.xsd&quot;&gt;</span><br><span class="line">    &lt;parent&gt;</span><br><span class="line">        &lt;artifactId&gt;cloud2020&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;groupId&gt;com.atguigu.springcloud&lt;&#x2F;groupId&gt;</span><br><span class="line">        &lt;version&gt;1.0-SNAPSHOT&lt;&#x2F;version&gt;</span><br><span class="line">    &lt;&#x2F;parent&gt;</span><br><span class="line">    &lt;modelVersion&gt;4.0.0&lt;&#x2F;modelVersion&gt;</span><br><span class="line"></span><br><span class="line">    &lt;artifactId&gt;cloud-consumerconsul-order80&lt;&#x2F;artifactId&gt;</span><br><span class="line"></span><br><span class="line">    &lt;dependencies&gt;</span><br><span class="line">        &lt;!-- https:&#x2F;&#x2F;mvnrepository.com&#x2F;artifact&#x2F;org.springframework.cloud&#x2F;spring-cloud-starter-consul-discovery --&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.cloud&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-cloud-starter-consul-discovery&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;com.atguigu.springcloud&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;cloud-api-commons&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;version&gt;1.0-SNAPSHOT&lt;&#x2F;version&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;!-- https:&#x2F;&#x2F;mvnrepository.com&#x2F;artifact&#x2F;org.springframework.boot&#x2F;spring-boot-starter-web --&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-web&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;!-- https:&#x2F;&#x2F;mvnrepository.com&#x2F;artifact&#x2F;org.springframework.boot&#x2F;spring-boot-starter-web --&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-actuator&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;!-- https:&#x2F;&#x2F;mvnrepository.com&#x2F;artifact&#x2F;org.springframework.boot&#x2F;spring-boot-devtools --&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-devtools&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;scope&gt;runtime&lt;&#x2F;scope&gt;</span><br><span class="line">            &lt;optional&gt;true&lt;&#x2F;optional&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;!-- https:&#x2F;&#x2F;mvnrepository.com&#x2F;artifact&#x2F;org.projectlombok&#x2F;lombok --&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.projectlombok&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;lombok&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;optional&gt;true&lt;&#x2F;optional&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;!-- https:&#x2F;&#x2F;mvnrepository.com&#x2F;artifact&#x2F;org.springframework.boot&#x2F;spring-boot-starter-test --&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-test&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;scope&gt;test&lt;&#x2F;scope&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">    &lt;&#x2F;dependencies&gt;</span><br><span class="line"></span><br><span class="line">&lt;&#x2F;project&gt;</span><br></pre></td></tr></table></figure></li>
<li><p>yml</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">server:</span><br><span class="line">  port: 80</span><br><span class="line">spring:</span><br><span class="line">  application:</span><br><span class="line">    name: cloud-consumer-order</span><br><span class="line">  cloud:</span><br><span class="line">    consul:</span><br><span class="line">      host: localhost</span><br><span class="line">      port: 8500</span><br><span class="line">      discovery:</span><br><span class="line">        service-name: $&#123;spring.application.name&#125;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h3 id="4-5-三个注册中心异同点"><a href="#4-5-三个注册中心异同点" class="headerlink" title="4.5 三个注册中心异同点"></a>4.5 三个注册中心异同点</h3><ol>
<li>CAP<ul>
<li>C:Consistency(强一致性)</li>
<li>A:Availability(可用性)</li>
<li>P:Partition tolerance(分区容错)</li>
<li>CAP理论关注粒度是数据，而不是整体系统设计的策略<br><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ghvx3gkg37j30mv07qtcq.jpg" alt=""></li>
</ul>
</li>
<li>经典CAP图<br><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ghvx2ezkkmj30pw0jbgrb.jpg" alt=""></li>
</ol>
<h2 id="5-Ribbon负载均衡服务调用"><a href="#5-Ribbon负载均衡服务调用" class="headerlink" title="5. Ribbon负载均衡服务调用"></a>5. Ribbon负载均衡服务调用</h2><h3 id="5-1-概述"><a href="#5-1-概述" class="headerlink" title="5.1 概述"></a>5.1 概述</h3><ol>
<li><p>是什么<br>Spring Cloud Ribbon 是基于 Netflix Ribbon 实现的一套==客户端负载均衡的工具==。<br>简单的说，Ribbonn是Netflix的开源项目，主要功能 是提供==客户端的软件负载均衡算法和服务调用。==Ribbon客户端组件提供一系列完善的配置项，如连接超时，重试等。就是在配置文件中列出 Loa Balancer后面所有机器，Ribbon会自动帮助你基于某种规则 (如简单轮询，随机连接等)去连接这些机器。我们很容易使用Ribbon实现自定义的负载均衡算法。</p>
</li>
<li><p>官网资料：<a href="https://github.com/Netflix/ribbon/wiki/Getting-Started" target="_blank" rel="noopener">https://github.com/Netflix/ribbon/wiki/Getting-Started</a></p>
</li>
<li><p>能干嘛</p>
<ul>
<li>LB(负载均衡)<ul>
<li>负载均衡(Load Balance)是什么<br>将用户的请求平摊的分配到多个服务上，从而达到HA(高可用)，常见的负载均衡有 Nginx,LVS,硬件 F5等。</li>
<li>Ribbon 本地负载均衡客户端 VS Nginx 服务端负载均衡<br>Nginx 是服务器 负载均衡，客户端所有请求都会交给 nginx，然后由 nginx实现请求转发。即负载均衡是由服务端实现的。<br>Ribbon 是本地负载均衡，在微服务调用接口时，在注册中心上获取注册信息服务列表 之后缓存在JVM本地，从而实现本地RPC远程服务调用技术</li>
</ul>
</li>
<li>前面我们讲解过了80通过轮询负载访问8001/8002</li>
<li>一句话<br>负载均衡+RestTemplate 调用</li>
</ul>
</li>
</ol>
<h3 id="5-2-Ribbon负载均衡演示"><a href="#5-2-Ribbon负载均衡演示" class="headerlink" title="5.2 Ribbon负载均衡演示"></a>5.2 Ribbon负载均衡演示</h3><ol>
<li><p>架构说明<br>Ribbon其实就是一个软负载均衡的客户端组件，他可以和其他所需请求的客户端结合使用，和eurake结合之事其中一个实例<br><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ghwd6wnewvj31680k2k4t.jpg" alt=""></p>
<ul>
<li>Ribbon工作时有两步<ol>
<li>第一步先选择 EurekaServer，优先选择统一区域负载较少的 server</li>
<li>第二部再根据用户指定的策略，从server取到的服务注册列表中选择一个地址。其中 Riibon 提供了多种策略（轮询，随机，根据响应时间加权）。</li>
</ol>
</li>
</ul>
</li>
<li><p>POM<br>不需要引入</p>
</li>
<li><p>RestTemplate的使用</p>
<ul>
<li><p>getForObject方法/getForEntity方法<br><code>getForObject</code>返回对象为响应体中数据转化成的对象，基本上可以理解为json<br><code>getForEntity</code>返回对象为ResponseEntity对象，包含响应中的一些重要信息，比如响应头、响应状态码、响应体</p>
</li>
<li><p>postForObject/postForEntity</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">@GetMapping(&quot;&#x2F;consumer&#x2F;payment&#x2F;forentity&#x2F;&#123;id&#125;&quot;)</span><br><span class="line">    public CommonResult&lt;Payment&gt; getPayment1(@PathVariable(&quot;id&quot;) Long id)&#123;</span><br><span class="line">        ResponseEntity&lt;CommonResult&gt; entity &#x3D; restTemplate.getForEntity(PAYMENT_URL + &quot;&#x2F;payment&#x2F;get&#x2F;&quot; + id, CommonResult.class);</span><br><span class="line">       if(entity.getStatusCode().is2xxSuccessful())&#123;</span><br><span class="line">           return entity.getBody();</span><br><span class="line">       &#125;else&#123;</span><br><span class="line">           return new CommonResult(444,&quot;操作失败&quot;);</span><br><span class="line">       &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li>
<li><p>GET请求方法</p>
</li>
<li><p>POST请求方法</p>
</li>
</ul>
</li>
</ol>
<h3 id="5-3-Ribbon核心组件IRule"><a href="#5-3-Ribbon核心组件IRule" class="headerlink" title="5.3 Ribbon核心组件IRule"></a>5.3 Ribbon核心组件IRule</h3><ol>
<li><p>IRule:根据特定算法从服务列表中选取一个要访问的服务</p>
<ol>
<li>RoundRobinRule   轮询</li>
<li>RandomRule   随机</li>
<li>RetryRule    先按照RoundRobinRule的 策略获取服务，如果获取服务失败则在指定时间里进行重试，获取可用服务</li>
<li>WeightedResponseTimeRule 对RoundRobinRule的扩展，响应速度越快，实例选择权重越大 ，越容易被选择</li>
<li>BestAvailableRule    会先过滤掉由于多次访问故障而处于断路器 跳闸状态的服务，然后选择一个并发一个最小的服务</li>
<li>BestAvaibilityFilteringRule  先过滤掉故障实例，再选择并发量较小的实例</li>
<li>ZoneAvoidanceRule    默认规则，符合server所在区域的性能和server的可用性选择服务器</li>
</ol>
</li>
<li><p>如何替换</p>
<ul>
<li><p>修改<code>cloud-consumer-order80</code></p>
</li>
<li><p>注意配置细节<br>IRule配置类不能放在@ComponentSan 的包及子包下，因为默认的扫描会变成全局负载均衡都按照这样的规则。</p>
</li>
<li><p>新建package:<code>com.atguigu.myrule</code></p>
</li>
<li><p>上面包下新建MySelfRule规则类</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">package com.atguigu.myrule;</span><br><span class="line"></span><br><span class="line">import com.netflix.loadbalancer.IRule;</span><br><span class="line">import com.netflix.loadbalancer.RandomRule;</span><br><span class="line">import org.springframework.context.annotation.Bean;</span><br><span class="line">import org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * @program: cloud2020</span><br><span class="line"> * @description: 规则类</span><br><span class="line"> * @author: Mr.Wang</span><br><span class="line"> * @create: 2020-08-20-09-12</span><br><span class="line"> *&#x2F;</span><br><span class="line">@Configuration</span><br><span class="line">public class MyselfRule &#123;</span><br><span class="line">    @Bean</span><br><span class="line">    public IRule myRule()&#123;</span><br><span class="line">        &#x2F;&#x2F;使用随机的负载均衡</span><br><span class="line">        return new RandomRule();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>主启动类添加@RibbonClient</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">package com.atguigu.springcloud;</span><br><span class="line"></span><br><span class="line">import com.atguigu.myrule.MyselfRule;</span><br><span class="line">import javafx.application.Application;</span><br><span class="line">import org.springframework.boot.SpringApplication;</span><br><span class="line">import org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line">import org.springframework.cloud.netflix.eureka.EnableEurekaClient;</span><br><span class="line">import org.springframework.cloud.netflix.ribbon.RibbonClient;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * @program: cloud2020</span><br><span class="line"> * @description: 订单类的启动器</span><br><span class="line"> * @author: Mr.Wang</span><br><span class="line"> * @create: 2020-08-16-19-52</span><br><span class="line"> *&#x2F;</span><br><span class="line">@SpringBootApplication</span><br><span class="line">@EnableEurekaClient</span><br><span class="line">&#x2F;&#x2F; 选择要接收的服务和配置类</span><br><span class="line">@RibbonClient(name&#x3D;&quot;cloud-payment-sesrvice&quot;,configuration &#x3D; MyselfRule.class)</span><br><span class="line">public class OrderMain80 &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        SpringApplication.run(OrderMain80.class,args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ghx0jo4qjfj31ii0k6hdt.jpg" alt=""></p>
</li>
</ul>
</li>
<li><p>测试</p>
</li>
</ul>
</li>
</ol>
<h3 id="5-4-Ribbon负载均衡算法"><a href="#5-4-Ribbon负载均衡算法" class="headerlink" title="5.4 Ribbon负载均衡算法"></a>5.4 Ribbon负载均衡算法</h3><ol>
<li>原理<br>负载均衡算法：rest接口第几次请求数 % 服务器集群=实际调用服务器位置下标，每次服务重启后rest接口计数从1开始<br><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ghx1mdw1bpj315q0hu165.jpg" alt=""><br>总台数：2台</li>
</ol>
<p>请求数  调用下标<br>1       1%2=1<br>2       2%2=0<br>3       3%2=1<br>4       4%2=0</p>
<ol start="2">
<li><p>RoundRobinRule源码</p>
</li>
<li><p>手写<br>具体详细的请看脑图笔记…</p>
<h2 id="6-OpenFeign服务接口调用"><a href="#6-OpenFeign服务接口调用" class="headerlink" title="6. OpenFeign服务接口调用"></a>6. OpenFeign服务接口调用</h2><h3 id="6-1-概述"><a href="#6-1-概述" class="headerlink" title="6.1 概述"></a>6.1 概述</h3></li>
<li><p>OpenFeign是什么<br>Feign是声明性Web服务客户端。它使编写Web服务客户端更加容易。要使用Feign，请创建一个接口并对其进行注释。它具有可插入的注释支持，包括Feign注释和JAX-RS注释。Feign还支持可插拔编码器和解码器。Spring Cloud添加了对Spring MVC注释的支持，并支持使用HttpMessageConvertersSpring Web中默认使用的注释。Spring Cloud集成了Ribbon和Eureka以及Spring Cloud LoadBalancer，以在使用Feign时提供负载平衡的http客户端。<br><a href="https://github.com/spring-cloud/spring-cloud-openfeign" target="_blank" rel="noopener">https://github.com/spring-cloud/spring-cloud-openfeign</a></p>
</li>
<li><p>能干嘛</p>
<ul>
<li>使编写Java Http客户端更加容易<br>使用 RestTemplate+Ribbon 时，利用 RestTemplate 对http 请求的封装处理，形成一套模板化的调用方法，但是在实际中，由于对服务的调用可能不止一处，往往一个接口会被多处调用，所以通常都会针对每个微服务自行封装一些客户端类来包装这些依赖服务的调用。所以Feign在此基础上做了进一步封装，由他来帮助我们定义和实现服务接口的定义。在==Feign的实现下我们只需要创建一个接口并使用注解来配置它(以前是Dao接口上标注Mapper注解，现在是一个微服务接口上面标注一个Feign注解即可)==。自动封装服务调用客户端的开发量。</li>
<li>Feign集成了Ribbon<br>利用Ribbon维护了Payment的服务列表信息，并且实现了轮询实现客户端的负载均衡。而与Ribbon不同的是，==feign只需要定义服务绑定接口且以声明式的方法==，优雅而简单的实现服务调用</li>
</ul>
</li>
<li><p>Fegin和OpenFeign两者区别<br><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ghx3ke4l7aj318y0bcdw0.jpg" alt=""></p>
</li>
</ol>
<h3 id="6-2-OpenFeign使用步骤"><a href="#6-2-OpenFeign使用步骤" class="headerlink" title="6.2 OpenFeign使用步骤"></a>6.2 OpenFeign使用步骤</h3><ol>
<li><p>接口+注解：<code>微服务调用的接口+@FeignClient</code></p>
</li>
<li><p>新建<code>cloud-consumer-feign-order80</code><br>Fegin用在消费端</p>
</li>
<li><p>POM</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;project xmlns&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0&quot;</span><br><span class="line">         xmlns:xsi&#x3D;&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;2001&#x2F;XMLSchema-instance&quot;</span><br><span class="line">         xsi:schemaLocation&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0 http:&#x2F;&#x2F;maven.apache.org&#x2F;xsd&#x2F;maven-4.0.0.xsd&quot;&gt;</span><br><span class="line">    &lt;parent&gt;</span><br><span class="line">        &lt;artifactId&gt;cloud2020&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;groupId&gt;com.atguigu.springcloud&lt;&#x2F;groupId&gt;</span><br><span class="line">        &lt;version&gt;1.0-SNAPSHOT&lt;&#x2F;version&gt;</span><br><span class="line">    &lt;&#x2F;parent&gt;</span><br><span class="line">    &lt;modelVersion&gt;4.0.0&lt;&#x2F;modelVersion&gt;</span><br><span class="line"></span><br><span class="line">    &lt;artifactId&gt;cloud-consumer-feign-order80&lt;&#x2F;artifactId&gt;</span><br><span class="line"></span><br><span class="line">    &lt;dependencies&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.cloud&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-cloud-starter-openfeign&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.cloud&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-cloud-starter-netflix-eureka-client&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;com.atguigu.springcloud&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;cloud-api-commons&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;version&gt;1.0-SNAPSHOT&lt;&#x2F;version&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-web&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-actuator&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-devtools&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;scope&gt;runtime&lt;&#x2F;scope&gt;</span><br><span class="line">            &lt;optional&gt;true&lt;&#x2F;optional&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.projectlombok&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;lombok&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;optional&gt;true&lt;&#x2F;optional&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-test&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;scope&gt;test&lt;&#x2F;scope&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">    &lt;&#x2F;dependencies&gt;</span><br><span class="line"></span><br><span class="line">&lt;&#x2F;project&gt;</span><br></pre></td></tr></table></figure></li>
<li><p>YML</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">server:</span><br><span class="line">  port: 80</span><br><span class="line">eureka:</span><br><span class="line">  client:</span><br><span class="line">    register-with-eureka: false</span><br><span class="line">    service-url:</span><br><span class="line">      defaultZone: http:&#x2F;&#x2F;localhost:7001&#x2F;eureka&#x2F;,http:&#x2F;&#x2F;localhost:7002&#x2F;eureka&#x2F;</span><br></pre></td></tr></table></figure></li>
<li><p>主启动类</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">package com.atguigu.springcloud;</span><br><span class="line"></span><br><span class="line">import org.springframework.boot.SpringApplication;</span><br><span class="line">import org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line">import org.springframework.cloud.client.discovery.EnableDiscoveryClient;</span><br><span class="line">import org.springframework.cloud.openfeign.EnableFeignClients;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * @program: cloud2020</span><br><span class="line"> * @description: 主启动类</span><br><span class="line"> * @author: Mr.Wang</span><br><span class="line"> * @create: 2020-08-20-11-24</span><br><span class="line"> *&#x2F;</span><br><span class="line">@SpringBootApplication</span><br><span class="line">@EnableDiscoveryClient</span><br><span class="line">&#x2F;&#x2F;激活fengin并使用</span><br><span class="line">@EnableFeignClients</span><br><span class="line">public class OrderfeignMain80 &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        SpringApplication.run(OrderfeignMain80.class,args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>业务类</p>
<ul>
<li><p>业务逻辑接口+@FeignClient配置调用provider服务<br><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ghx57vtvwwj317u0pcnpd.jpg" alt=""></p>
</li>
<li><p>新建<code>PaymentFeignService</code>接口并新政注解<code>@FeignClient</code></p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">package com.atguigu.springcloud.service;</span><br><span class="line"></span><br><span class="line">import com.atguigu.springcloud.entities.CommonResult;</span><br><span class="line">import com.atguigu.springcloud.entities.Payment;</span><br><span class="line">import org.springframework.cloud.openfeign.FeignClient;</span><br><span class="line">import org.springframework.stereotype.Component;</span><br><span class="line">import org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line">import org.springframework.web.bind.annotation.PathVariable;</span><br><span class="line"></span><br><span class="line">@Component</span><br><span class="line">&#x2F;**</span><br><span class="line"> * name:找哪个微服务</span><br><span class="line"> *&#x2F;</span><br><span class="line"> &#x2F;&#x2F; 将业务提供者的名写进去</span><br><span class="line">@FeignClient(name&#x3D;&quot;cloud-payment-service&quot;)</span><br><span class="line">public interface PaymentFeignService &#123;</span><br><span class="line">&#x2F;&#x2F; 将业务提供者的controller路径和方法复制粘贴进来</span><br><span class="line">    @GetMapping(value &#x3D; &quot;&#x2F;payment&#x2F;get&#x2F;&#123;id&#125;&quot;)</span><br><span class="line">    public CommonResult getPaymentById(@PathVariable(&quot;id&quot;) Long id);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>控制层Controller</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">package com.atguigu.springcloud.controller;</span><br><span class="line"></span><br><span class="line">import com.atguigu.springcloud.entities.CommonResult;</span><br><span class="line">import com.atguigu.springcloud.entities.Payment;</span><br><span class="line">import com.atguigu.springcloud.service.PaymentFeignService;</span><br><span class="line">import lombok.extern.slf4j.Slf4j;</span><br><span class="line">import org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line">import org.springframework.web.bind.annotation.PathVariable;</span><br><span class="line">import org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line">import javax.annotation.Resource;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * @program: cloud2020</span><br><span class="line"> * @description: 控制层</span><br><span class="line"> * @author: Mr.Wang</span><br><span class="line"> * @create: 2020-08-20-11-36</span><br><span class="line"> *&#x2F;</span><br><span class="line">@RestController</span><br><span class="line">@Slf4j</span><br><span class="line">public class OrderFeignController &#123;</span><br><span class="line">    @Resource</span><br><span class="line">    private PaymentFeignService paymentFeignService;</span><br><span class="line"></span><br><span class="line">    @GetMapping(&quot;&#x2F;consumer&#x2F;payment&#x2F;get&#x2F;&#123;id&#125;&quot;)</span><br><span class="line">    public CommonResult&lt;Payment&gt; getPaymentById(@PathVariable(&quot;id&quot;)Long id)&#123;</span><br><span class="line">        return paymentFeignService.getPaymentById(id);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>测试</p>
<ul>
<li>先启动2个Eureka集群7001/7002</li>
<li>在启动2个微服务8001/8002</li>
<li>启动OpenFegin启动</li>
<li><a href="http://localhost/consumer/payment/get/1" target="_blank" rel="noopener">http://localhost/consumer/payment/get/1</a></li>
<li>Feign自带负载均衡配置项</li>
</ul>
</li>
<li><p>小总结<br><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ghx59t9ee8j319i0ia4gu.jpg" alt=""></p>
</li>
</ol>
<h3 id="6-3-OpenFeign超时控制"><a href="#6-3-OpenFeign超时控制" class="headerlink" title="6.3 OpenFeign超时控制"></a>6.3 OpenFeign超时控制</h3><ol>
<li><p>超时设置，故意设置超时演示出错情况</p>
<ul>
<li><p>服务提供方8001故意写暂停程序</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">@GetMapping(&quot;&#x2F;payment&#x2F;feign&#x2F;timeout&quot;)</span><br><span class="line">    public String paymentFeignTimeout()&#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            TimeUnit.SECONDS.sleep(3);</span><br><span class="line">        &#125; catch (InterruptedException e) &#123;</span><br><span class="line">           e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        return serverPort;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li>
<li><p>服务消费方80添加超时方法PaymentFeginService<br><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ghx9rjcybnj31580k47wh.jpg" alt=""></p>
</li>
<li><p>服务消费方80添加超时方法OrderFeginController<br><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ghx9ry0vavj30wg084k13.jpg" alt=""></p>
</li>
<li><p>测试</p>
<ul>
<li><a href="http://localhost/consumer/payment/feign/timeout" target="_blank" rel="noopener">http://localhost/consumer/payment/feign/timeout</a></li>
<li>错误页面：<strong><em>==这里需要只启动修改过的服务==</em></strong><br><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ghx8tpp26fj31bb0u0tl6.jpg" alt=""></li>
</ul>
</li>
</ul>
</li>
<li><p>OpenFeign默认等待一秒钟，超期后报错</p>
</li>
<li><p>是什么<br>默认Feign客户端只等待一秒钟，但是服务端处理需要超过1秒钟，导致Feign客户端不想等待了，直接返回报错。为了避免这样的情况，有时候我们需要设置客户端的超时控制。</p>
</li>
<li><p>YML文件里需要开启OpenFeign客户端超时控制</p>
</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">server:</span><br><span class="line">  port: 80</span><br><span class="line">eureka:</span><br><span class="line">  client:</span><br><span class="line">    register-with-eureka: false</span><br><span class="line">    service-url:</span><br><span class="line">      defaultZone: http:&#x2F;&#x2F;localhost:7001&#x2F;eureka&#x2F;,http:&#x2F;&#x2F;localhost:7002&#x2F;eureka&#x2F;</span><br><span class="line"># 添加一下的配置</span><br><span class="line"># 设置feign客户端超时时间（openfign默认支持ribbon）</span><br><span class="line">ribbon:</span><br><span class="line">  # 指得失建立链接所用的时间，适用于网络状况正常的情况下。两端链接所用的时间</span><br><span class="line">  ReadTimeout:  5000</span><br><span class="line">  # 指的是建立链接后从服务器读取到可用资源所用的时间</span><br><span class="line">  ConnectTimeout: 5000</span><br></pre></td></tr></table></figure>
<h3 id="6-4-OpenFeign日志打印功能"><a href="#6-4-OpenFeign日志打印功能" class="headerlink" title="6.4 OpenFeign日志打印功能"></a>6.4 OpenFeign日志打印功能</h3><ol>
<li><p>日志打印功能</p>
</li>
<li><p>是什么<br>Feign提供了日志打印功能，我们可以通过配置来调整日志级别，从而了解Feign中Http请求的细节。说白了就是==对Feign接口调用情况进行监控和输出==</p>
</li>
<li><p>日志级别</p>
<ul>
<li>NONE：默认不显示日志</li>
<li>BASIC：仅记录请求方法，URL，响应状态及执行时间</li>
<li>HEADERS：除了BASIC中定义的信息之外，还有请求和响应的头信息</li>
<li>FULL：除了HEADERS中定义的信息外，还有请求和响应的正文及元数据</li>
</ul>
</li>
<li><p>配置日志bean</p>
<pre><code><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">package com.atguigu.springcloud.config;</span><br><span class="line"></span><br><span class="line">import feign.Logger;</span><br><span class="line">import org.springframework.context.annotation.Bean;</span><br><span class="line">import org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * @program: cloud2020</span><br><span class="line"> * @description: feign的配置类</span><br><span class="line"> * @author: Mr.Wang</span><br><span class="line"> * @create: 2020-08-20-14-52</span><br><span class="line"> *&#x2F;</span><br><span class="line">@Configuration</span><br><span class="line">public class FeignLog &#123;</span><br><span class="line">    @Bean</span><br><span class="line">    Logger.Level feignLoggerlevel()&#123;</span><br><span class="line">        return Logger.Level.FULL;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></code></pre></li>
<li><p>YML文件里需要开启日期的Feign客户端</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">server:</span><br><span class="line">  port: 80</span><br><span class="line">eureka:</span><br><span class="line">  client:</span><br><span class="line">    register-with-eureka: false</span><br><span class="line">    service-url:</span><br><span class="line">      defaultZone: http:&#x2F;&#x2F;localhost:7001&#x2F;eureka&#x2F;,http:&#x2F;&#x2F;localhost:7002&#x2F;eureka&#x2F;</span><br><span class="line"># 设置feign客户端超时时间（openfign默认支持ribbon）</span><br><span class="line">ribbon:</span><br><span class="line">  # 指得失建立链接所用的时间，适用于网络状况正常的情况下。两端链接所用的时间</span><br><span class="line">  ReadTimeout:  5000</span><br><span class="line">  # 指的是建立链接后从服务器读取到可用资源所用的时间</span><br><span class="line">  ConnectTimeout: 5000</span><br><span class="line">logging:</span><br><span class="line">  level:</span><br><span class="line">    #feign日志以什么级别监控哪个接口</span><br><span class="line">    com.atguigu.springcloud.service.PaymentFeginService: debug</span><br></pre></td></tr></table></figure>
</li>
<li><p>后台日志查看</p>
</li>
</ol>
<h2 id="7-Hystrix断路器"><a href="#7-Hystrix断路器" class="headerlink" title="7. Hystrix断路器"></a>7. Hystrix断路器</h2><h3 id="7-1-概述"><a href="#7-1-概述" class="headerlink" title="7.1 概述"></a>7.1 概述</h3><ol>
<li>分布式系统面临的问题<br>复杂分布式系统中的应用程序有数十个依赖关系，每个依赖关系在某些时候不可避免的失败。<br>多个微服务之间调用时，假设 A 调B和C，B和C又调其他微服务，就是所谓的扇出。当扇出的链路上某个微服务响应时间过长或不可用对A的调用就会占用越来越多的资源，进而引起系统崩溃 ，所谓的雪崩效应。</li>
<li>是什么<br>Hystrix 是处理分布式系统的延迟和容错的开源库，保证一个依赖出现问题时不会导致整体服务失败，避免级联故障，以提高分布式系统弹性。<br>断路器本身是一种开关装置，当某个服务单元发生故障后，通过断路器的故障监控，向调用方返回一个符合预期的可处理的备选响应，而不是长时间的等待或抛出调用方法无法处理的异常 。</li>
<li>能干嘛<ul>
<li>服务降级</li>
<li>服务熔断</li>
<li>接近实时的监控</li>
</ul>
</li>
<li>官网资料：<a href="https://github.com/Netflix/Hystrix/wiki/How-To-Use" target="_blank" rel="noopener">https://github.com/Netflix/Hystrix/wiki/How-To-Use</a></li>
<li>Hystrix官宣，停更进维：<a href="https://github.com/Netflix/Hystrix" target="_blank" rel="noopener">https://github.com/Netflix/Hystrix</a><ul>
<li>被动修复bugs</li>
<li>不再接受合并请求</li>
<li>不再发布新版本</li>
</ul>
</li>
</ol>
<h3 id="7-2-Hystrix重要概念"><a href="#7-2-Hystrix重要概念" class="headerlink" title="7.2 Hystrix重要概念"></a>7.2 Hystrix重要概念</h3><ol>
<li>服务降级<br>服务器忙，请稍后重试，不让客户端等待并立即返回一个友好的提示。fallback<br> 哪些情况会导致服务降级？ <ul>
<li>程序运行异常</li>
<li>超时</li>
<li>服务熔断触发服务降级</li>
<li>线程池/信号量打满</li>
</ul>
</li>
<li>服务熔断<ul>
<li>类比保险丝达到最大服务访问时，直接拒绝访问，拉闸限电，然后调用服务降级的方法返回友好提示。</li>
<li>服务降级-&gt;进而熔断-&gt;恢复调用链路</li>
</ul>
</li>
<li>服务限流<ul>
<li>秒杀高并发等操作，严禁一窝蜂过来拥挤，一秒N个有序进行</li>
</ul>
</li>
</ol>
<h3 id="7-3-hystrix案例"><a href="#7-3-hystrix案例" class="headerlink" title="7.3 hystrix案例"></a>7.3 hystrix案例</h3><ol>
<li><p>构建</p>
<ul>
<li><p>新建<code>cloud-provider-hystrix-payment8001</code></p>
</li>
<li><p>POM</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;project xmlns&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0&quot;</span><br><span class="line">         xmlns:xsi&#x3D;&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;2001&#x2F;XMLSchema-instance&quot;</span><br><span class="line">         xsi:schemaLocation&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0 http:&#x2F;&#x2F;maven.apache.org&#x2F;xsd&#x2F;maven-4.0.0.xsd&quot;&gt;</span><br><span class="line">    &lt;parent&gt;</span><br><span class="line">        &lt;artifactId&gt;cloud2020&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;groupId&gt;com.atguigu.springcloud&lt;&#x2F;groupId&gt;</span><br><span class="line">        &lt;version&gt;1.0-SNAPSHOT&lt;&#x2F;version&gt;</span><br><span class="line">    &lt;&#x2F;parent&gt;</span><br><span class="line">    &lt;modelVersion&gt;4.0.0&lt;&#x2F;modelVersion&gt;</span><br><span class="line"></span><br><span class="line">    &lt;artifactId&gt;cloud-provider-hystrix-payment8001&lt;&#x2F;artifactId&gt;</span><br><span class="line"></span><br><span class="line">    &lt;dependencies&gt;</span><br><span class="line">        &lt;!--新增hystrix--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.cloud&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-cloud-starter-netflix-hystrix&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.cloud&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-cloud-starter-netflix-eureka-client&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;com.atguigu.springcloud&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;cloud-api-commons&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;version&gt;1.0-SNAPSHOT&lt;&#x2F;version&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-web&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-actuator&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-devtools&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;scope&gt;runtime&lt;&#x2F;scope&gt;</span><br><span class="line">            &lt;optional&gt;true&lt;&#x2F;optional&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.projectlombok&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;lombok&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;optional&gt;true&lt;&#x2F;optional&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-test&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;scope&gt;test&lt;&#x2F;scope&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">    &lt;&#x2F;dependencies&gt;</span><br><span class="line"></span><br><span class="line">&lt;&#x2F;project&gt;</span><br></pre></td></tr></table></figure></li>
<li><p>YML</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">server:</span><br><span class="line">  port: 8001</span><br><span class="line">spring:</span><br><span class="line">  application:</span><br><span class="line">    name: cloud-provider-hystrix-payment</span><br><span class="line"></span><br><span class="line">eureka:</span><br><span class="line">  client:</span><br><span class="line">    service-url:</span><br><span class="line">      defaultZone: http:&#x2F;&#x2F;localhost:7001&#x2F;eureka</span><br><span class="line">    register-with-eureka: true</span><br><span class="line">    fetch-registry: true</span><br></pre></td></tr></table></figure></li>
<li><p>主启动</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">package com.atguigu.springcloud;</span><br><span class="line"></span><br><span class="line">import org.springframework.boot.SpringApplication;</span><br><span class="line">import org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line">import org.springframework.cloud.client.discovery.EnableDiscoveryClient;</span><br><span class="line">import org.springframework.cloud.netflix.eureka.EnableEurekaClient;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * @program: cloud2020</span><br><span class="line"> * @description: 主启动类</span><br><span class="line"> * @author: Mr.Wang</span><br><span class="line"> * @create: 2020-08-20-20-51</span><br><span class="line"> *&#x2F;</span><br><span class="line">@SpringBootApplication</span><br><span class="line">@EnableDiscoveryClient</span><br><span class="line">@EnableEurekaClient</span><br><span class="line">public class PaymentHystrixMain8001 &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        SpringApplication.run(PaymentHystrixMain8001.class,args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>业务类</p>
<ul>
<li><p>service</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">package com.atguigu.springcloud.service;</span><br><span class="line"></span><br><span class="line">import ch.qos.logback.core.util.TimeUtil;</span><br><span class="line">import org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line">import java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * @program: cloud2020</span><br><span class="line"> * @description: 业务类</span><br><span class="line"> * @author: Mr.Wang</span><br><span class="line"> * @create: 2020-08-20-21-17</span><br><span class="line"> *&#x2F;</span><br><span class="line">@Service</span><br><span class="line">public class PaymentService &#123;</span><br><span class="line">    &#x2F;&#x2F;正常访问肯定OK的方法</span><br><span class="line">    public String paymentInfo_ok(Integer id)&#123;</span><br><span class="line">        return &quot;线程池:&quot;+Thread.currentThread().getName()+&quot; paymentInfo_ok,id&quot;+id+&quot;\t&quot;+&quot;哈哈😄&quot;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String paymentInfo_timeout(Integer id)&#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            TimeUnit.SECONDS.sleep(3);</span><br><span class="line">        &#125; catch (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        return &quot;线程池:&quot;+Thread.currentThread().getName()+&quot; paymentInfo_timeout,id&quot;+id+&quot;\t&quot;+&quot;耗时3秒钟&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>controller</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">package com.atguigu.springcloud.controller;</span><br><span class="line"></span><br><span class="line">import com.atguigu.springcloud.service.PaymentService;</span><br><span class="line">import lombok.extern.slf4j.Slf4j;</span><br><span class="line">import org.springframework.beans.factory.annotation.Value;</span><br><span class="line">import org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line">import org.springframework.web.bind.annotation.PathVariable;</span><br><span class="line">import org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line">import javax.annotation.Resource;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * @program: cloud2020</span><br><span class="line"> * @description: kongzhiceng</span><br><span class="line"> * @author: Mr.Wang</span><br><span class="line"> * @create: 2020-08-20-21-22</span><br><span class="line"> *&#x2F;</span><br><span class="line">@RestController</span><br><span class="line">@Slf4j</span><br><span class="line">public class PaymentController &#123;</span><br><span class="line">    @Resource</span><br><span class="line">    private PaymentService paymentService;</span><br><span class="line">    @Value(&quot;$&#123;server.port&#125;&quot;)</span><br><span class="line">    private String serverPort;</span><br><span class="line"></span><br><span class="line">    @GetMapping(&quot;&#x2F;payment&#x2F;hystrix&#x2F;ok&#x2F;&#123;id&#125;&quot;)</span><br><span class="line">    public String paymentInfo_ok(@PathVariable(&quot;id&quot;) Integer id)&#123;</span><br><span class="line">        String result &#x3D; paymentService.paymentInfo_ok(id);</span><br><span class="line">        log.info(&quot;****result&quot;+result);</span><br><span class="line">        return result;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    @GetMapping(&quot;&#x2F;payment&#x2F;hystrix&#x2F;timeout&#x2F;&#123;id&#125;&quot;)</span><br><span class="line">    public String paymentInfo_timeout(@PathVariable(&quot;id&quot;) Integer id)&#123;</span><br><span class="line">        String result &#x3D; paymentService.paymentInfo_timeout(id);</span><br><span class="line">        log.info(&quot;****result&quot;+result);</span><br><span class="line">        return result;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



</li>
</ul>
</li>
</ul>
</li>
</ol>
<ul>
<li><p>正常测试</p>
<ul>
<li>启动eureka7001</li>
<li>启动cloud-provider-hystrix-payment8001</li>
<li>访问：<a href="http://localhost:8001/payment/hystrix/ok/31" target="_blank" rel="noopener">http://localhost:8001/payment/hystrix/ok/31</a></li>
<li>每次调用耗费5秒钟：<a href="http://localhost:8001/payment/hystrix/timeout/31" target="_blank" rel="noopener">http://localhost:8001/payment/hystrix/timeout/31</a></li>
<li>上述module均OK：以上述为根基平台，从正确-&gt;错误-&gt;降级熔断-&gt;恢复<ol>
<li>高并发测试</li>
</ol>
<ul>
<li>上述在非高并发情形下，还能勉强满足   but…..</li>
<li>Jmeter压测测试</li>
</ul>
</li>
<li>开启Jmeter,来20000个并发压死8001，20000个请求都去访问paymentInfo_TimeOut服务</li>
<li>再来一个访问：<a href="http://localhost:8001/payment/hystrix/ok/31、http://localhost:8001/payment/hystrix/timeout/31" target="_blank" rel="noopener">http://localhost:8001/payment/hystrix/ok/31、http://localhost:8001/payment/hystrix/timeout/31</a></li>
<li>看演示结果：两个都在自己转圈圈</li>
<li>为什么会被卡死：tomcat的默认的工作线程数被打满了，没有多余的线程来分解压力和处理。<ul>
<li>Jmeter压测结论<br>上面还是服务提供者8001自己测试，假如此时外部的消费者80也来访问，那消费者只能干等，最终导致消费端80不满意，服务端8001直接被拖死</li>
<li>看热闹不嫌弃事大，80新建加入</li>
</ul>
</li>
</ul>
<ol>
<li><p>新建<code>cloud-consumer-feign-hystrix-order80</code></p>
</li>
<li><p>POM</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;project xmlns&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0&quot;</span><br><span class="line">         xmlns:xsi&#x3D;&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;2001&#x2F;XMLSchema-instance&quot;</span><br><span class="line">         xsi:schemaLocation&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0 http:&#x2F;&#x2F;maven.apache.org&#x2F;xsd&#x2F;maven-4.0.0.xsd&quot;&gt;</span><br><span class="line">    &lt;parent&gt;</span><br><span class="line">        &lt;artifactId&gt;cloud2020&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;groupId&gt;com.atguigu.springcloud&lt;&#x2F;groupId&gt;</span><br><span class="line">        &lt;version&gt;1.0-SNAPSHOT&lt;&#x2F;version&gt;</span><br><span class="line">    &lt;&#x2F;parent&gt;</span><br><span class="line">    &lt;modelVersion&gt;4.0.0&lt;&#x2F;modelVersion&gt;</span><br><span class="line"></span><br><span class="line">    &lt;artifactId&gt;cloud-consumer-feign-hystrix-order80&lt;&#x2F;artifactId&gt;</span><br><span class="line"></span><br><span class="line">    &lt;dependencies&gt;</span><br><span class="line">        &lt;!--新增hystrix--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.cloud&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-cloud-starter-netflix-hystrix&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.cloud&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-cloud-starter-openfeign&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.cloud&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-cloud-starter-netflix-eureka-client&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;com.atguigu.springcloud&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;cloud-api-commons&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;version&gt;1.0-SNAPSHOT&lt;&#x2F;version&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-web&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-actuator&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-devtools&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;scope&gt;runtime&lt;&#x2F;scope&gt;</span><br><span class="line">            &lt;optional&gt;true&lt;&#x2F;optional&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.projectlombok&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;lombok&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;optional&gt;true&lt;&#x2F;optional&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-test&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;scope&gt;test&lt;&#x2F;scope&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">    &lt;&#x2F;dependencies&gt;</span><br><span class="line"></span><br><span class="line">&lt;&#x2F;project&gt;</span><br></pre></td></tr></table></figure></li>
<li><p>YML</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">server:</span><br><span class="line">  port: 80</span><br><span class="line"></span><br><span class="line">eureka:</span><br><span class="line">  client:</span><br><span class="line">    register-with-eureka: false</span><br><span class="line">    service-url:</span><br><span class="line">      defaultZone: http:&#x2F;&#x2F;localhost:7001&#x2F;eureka&#x2F;</span><br></pre></td></tr></table></figure></li>
<li><p>主启动</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">package com.atguigu.springcloud;</span><br><span class="line"></span><br><span class="line">import org.springframework.boot.SpringApplication;</span><br><span class="line">import org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line">import org.springframework.cloud.netflix.eureka.EnableEurekaClient;</span><br><span class="line">import org.springframework.cloud.openfeign.EnableFeignClients;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * @program: cloud2020</span><br><span class="line"> * @description: 主启动类</span><br><span class="line"> * @author: Mr.Wang</span><br><span class="line"> * @create: 2020-08-20-22-25</span><br><span class="line"> *&#x2F;</span><br><span class="line">@SpringBootApplication</span><br><span class="line">@EnableEurekaClient</span><br><span class="line">@EnableFeignClients</span><br><span class="line">public class OrderHystrixMain80 &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        SpringApplication.run(OrderHystrixMain80.class</span><br><span class="line">        ,args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>业务类</p>
<ul>
<li><p>service</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">package com.atguigu.springcloud.service;</span><br><span class="line"></span><br><span class="line">import org.springframework.cloud.openfeign.FeignClient;</span><br><span class="line">import org.springframework.stereotype.Component;</span><br><span class="line">import org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line">import org.springframework.web.bind.annotation.PathVariable;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * @program: cloud2020</span><br><span class="line"> * @description: 服务类</span><br><span class="line"> * @author: Mr.Wang</span><br><span class="line"> * @create: 2020-08-20-22-29</span><br><span class="line"> *&#x2F;</span><br><span class="line">@Component</span><br><span class="line">@FeignClient(name &#x3D; &quot;CLOUD-PROVIDER-HYSTRIX-PAYMENT&quot;)</span><br><span class="line">public interface PaymentHystrixService &#123;</span><br><span class="line"></span><br><span class="line">    @GetMapping(&quot;&#x2F;payment&#x2F;hystrix&#x2F;ok&#x2F;&#123;id&#125;&quot;)</span><br><span class="line">    public String paymentInfo_ok(@PathVariable(&quot;id&quot;) Integer id);</span><br><span class="line">    @GetMapping(&quot;&#x2F;payment&#x2F;hystrix&#x2F;timeout&#x2F;&#123;id&#125;&quot;)</span><br><span class="line">    public String paymentInfo_timeout(@PathVariable(&quot;id&quot;) Integer id);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>controller</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">    package com.atguigu.springcloud.controller;</span><br><span class="line">    </span><br><span class="line">    import com.atguigu.springcloud.service.PaymentHystrixService;</span><br><span class="line">    import lombok.extern.slf4j.Slf4j;</span><br><span class="line">    import org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line">    import org.springframework.web.bind.annotation.PathVariable;</span><br><span class="line">    import org.springframework.web.bind.annotation.RestController;</span><br><span class="line">    </span><br><span class="line">    import javax.annotation.Resource;</span><br><span class="line">    </span><br><span class="line">    &#x2F;**</span><br><span class="line">     * @program: cloud2020</span><br><span class="line">     * @description: kongzhiceng</span><br><span class="line">     * @author: Mr.Wang</span><br><span class="line">     * @create: 2020-08-20-22-42</span><br><span class="line">     *&#x2F;</span><br><span class="line">    @RestController</span><br><span class="line">    @Slf4j</span><br><span class="line">    public class PaymentHystirxController &#123;</span><br><span class="line">    </span><br><span class="line">        @Resource</span><br><span class="line">        private PaymentHystrixService paymentHystrixService;</span><br><span class="line">        @GetMapping(&quot;&#x2F;consumer&#x2F;payment&#x2F;hystrix&#x2F;ok&#x2F;&#123;id&#125;&quot;)</span><br><span class="line">        public String paymentInfo_ok(@PathVariable(&quot;id&quot;) Integer id)&#123;</span><br><span class="line">            return paymentHystrixService.paymentInfo_ok(id);</span><br><span class="line">        &#125;</span><br><span class="line">        @GetMapping(&quot;&#x2F;consumer&#x2F;payment&#x2F;hystrix&#x2F;timeout&#x2F;&#123;id&#125;&quot;)</span><br><span class="line">        public String paymentInfo_timeout(@PathVariable(&quot;id&quot;) Integer id)&#123;</span><br><span class="line">            return paymentHystrixService.paymentInfo_timeout(id);</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>正常测试:<a href="http://localhost/consumer/payment/hystrix/ok/31" target="_blank" rel="noopener">http://localhost/consumer/payment/hystrix/ok/31</a></p>
</li>
<li><p>高并发测试</p>
<ul>
<li>2W个线程压8001</li>
<li>消费端80微服务再去访问正常的OK微服务8001地址</li>
<li><a href="http://localhost/consumer/payment/hystrix/timeout/31" target="_blank" rel="noopener">http://localhost/consumer/payment/hystrix/timeout/31</a></li>
<li>消费者80:要么转圈圈等待,要么消费端报超时错误<ol>
<li>故障现象和导致原因<br>8001同一层次的其他接口服务被困死，因为tomcat线程里面的工作线程已经被挤占完毕,0此时调用8001，客户端访问响应缓慢，转圈圈</li>
<li>上诉结论<br>正因为有上述故障或不佳表现，才有我们的降级/容错/限流等技术诞生</li>
<li>如何解决，解决的要求</li>
</ol>
<ul>
<li>超时导致服务器变慢（转圈:超时不再等待</li>
<li>出错(宕机或程序运行出错):出错要有兜底</li>
<li>解决</li>
</ul>
</li>
</ul>
</li>
</ol>
<ul>
<li>对方服务（8001）超时了，调用者（80）不能一直卡死等待，必须有服务降级</li>
<li>对方服务（8001）down机了，调用者（80）不能一直卡死等待，必须有服务降级</li>
<li>对方服务（8001）OK，调用者（80）自己出故障或有自我要求（自己的等待时间小于服务提供者），自己处理降级</li>
</ul>
</li>
</ul>
<h4 id="7-3-1-服务降级"><a href="#7-3-1-服务降级" class="headerlink" title="7.3.1 服务降级"></a>7.3.1 服务降级</h4><h5 id="7-3-1-1-降级配置"><a href="#7-3-1-1-降级配置" class="headerlink" title="7.3.1.1. 降级配置"></a>7.3.1.1. 降级配置</h5><p><code>@HystrixCommand</code></p>
<h5 id="7-3-1-2-8001先从自身找问题"><a href="#7-3-1-2-8001先从自身找问题" class="headerlink" title="7.3.1.2. 8001先从自身找问题"></a>7.3.1.2. 8001先从自身找问题</h5><p>设置自身调用超时时间的峰值，峰值内可以正常运行，超过了需要有兜底的方法处理，作服务降级fallback</p>
<h5 id="7-3-1-3-8001fallback"><a href="#7-3-1-3-8001fallback" class="headerlink" title="7.3.1.3. 8001fallback"></a>7.3.1.3. 8001fallback</h5><ol>
<li><p>业务类启用<br><code>@HystrixCommand</code>报异常后如何处理<br>一旦调用服务方法失败并抛出了错误信息后，会自动调用@HystrixCommand标注好的fallbackMethod调用类中的指定方法。<br>==代码示例：==</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">   </span><br><span class="line">&#x2F;**</span><br><span class="line">     * fallbackmetod：系统异常或者超时后的兜底方案</span><br><span class="line">     * commandProperties -&gt; HystrixProperty -&gt; execution.isolation.thread.timeoutInMilliseconds :系统超时的时间</span><br><span class="line">     * @param id</span><br><span class="line">     * @return</span><br><span class="line">     *&#x2F;</span><br><span class="line">    @HystrixCommand(fallbackMethod &#x3D; &quot;paymentInfo_timeoutHandler&quot;,commandProperties &#x3D; &#123;</span><br><span class="line">            @HystrixProperty(name&#x3D;&quot;execution.isolation.thread.timeoutInMilliseconds&quot;,value &#x3D; &quot;3000&quot;)</span><br><span class="line">    &#125;)</span><br><span class="line">    public String paymentInfo_timeout(Integer id)&#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            TimeUnit.SECONDS.sleep(5);</span><br><span class="line">        &#125; catch (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        return &quot;线程池:&quot;+Thread.currentThread().getName()+&quot; paymentInfo_timeout,id&quot;+id+&quot;\t&quot;+&quot;耗时3秒钟&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">    public String paymentInfo_timeoutHandler(Integer id)&#123;</span><br><span class="line">        return &quot;线程池:&quot;+Thread.currentThread().getName()+&quot; paymentInfo_timeoutHandler,id&quot;+id;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ghy8j2pqjej31xr0u01kz.jpg" alt=""></p>
</li>
<li><p>主启动类激活：添加新注解<code>@EnableCircuitBreaker</code></p>
</li>
</ol>
<h5 id="7-3-1-4-80fallback"><a href="#7-3-1-4-80fallback" class="headerlink" title="7.3.1.4. 80fallback"></a>7.3.1.4. 80fallback</h5><ol>
<li><p>80订单微服务，也可以更好的保护自己，自己也依样画葫芦进行客户端降级保护</p>
</li>
<li><p>题外话，切记<br>我们自己配置过的热部署方式对java代码的改动明显，但对@HystrixCommand内属性的修改建议重启微服务</p>
</li>
<li><p>YML<br>在80的客户端yml文件中添加如下代码配置</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">feign:</span><br><span class="line">  hystrix:</span><br><span class="line">    enabled: true  #如果处理自身的容错就开启。开启方式与生产端不一样。</span><br></pre></td></tr></table></figure>
<p> <img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ghy9coq979j319o0jye81.jpg" alt=""></p>
</li>
<li><p>主启动<br><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ghy9d5z0vmj31e20nqqv5.jpg" alt=""></p>
</li>
<li><p>业务类</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">@HystrixCommand(fallbackMethod &#x3D; &quot;paymentTimeoutFallcackMethod&quot;,commandProperties  &#x3D;&#123;</span><br><span class="line">           @HystrixProperty(name &#x3D; &quot;execution.isolation.thread.timeoutInMilliseconds&quot;,value &#x3D; &quot;1500&quot;)</span><br><span class="line">    &#125;)</span><br><span class="line">    @GetMapping(&quot;&#x2F;consumer&#x2F;payment&#x2F;hystrix&#x2F;timeout&#x2F;&#123;id&#125;&quot;)</span><br><span class="line">    public String paymentInfo_timeout(@PathVariable(&quot;id&quot;) Integer id)&#123;</span><br><span class="line">        return paymentHystrixService.paymentInfo_timeout(id);</span><br><span class="line">    &#125;</span><br><span class="line">    public String paymentTimeoutFallcackMethod(@PathVariable(&quot;id&quot;) Integer id)&#123;</span><br><span class="line">        return &quot;消费者客户端80的服务报错了&quot;;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p> <img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ghy9ec2kokj31ok0pg7wi.jpg" alt=""></p>
<h5 id="7-3-1-5-目前问题"><a href="#7-3-1-5-目前问题" class="headerlink" title="7.3.1.5. 目前问题"></a>7.3.1.5. 目前问题</h5></li>
<li><p>每个业务方法对应一个兜底的方法，代码膨胀</p>
</li>
<li><p>统一和自定义的分开</p>
</li>
</ol>
<h5 id="7-3-1-6-解决问题"><a href="#7-3-1-6-解决问题" class="headerlink" title="7.3.1.6. 解决问题"></a>7.3.1.6. 解决问题</h5><ol>
<li><p>每个方法配置一个？？？膨胀</p>
<ul>
<li><p>feign接口系列</p>
</li>
<li><p>@DefaultProperties(defaultFallback = “”)<br><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ghy9mfyh6jj318m0k2qfa.jpg" alt=""><br>说明:<br>1:1 每个方法配置一个服务降级的方法，技术上可以，实际上操作是不可实现的<br>1:N 除了个别重要核心业务有专属，其它普通的可以通过<code>@DefaultProperties(defaultFallback = &quot;&quot;)</code>统一跳转到统一处理结果页面<br>通用的和独享的各自分开，避免了代码膨胀，合理减少了代码量。</p>
</li>
<li><p>controller配置</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">package com.atguigu.springcloud.controller;</span><br><span class="line"></span><br><span class="line">import com.atguigu.springcloud.service.PaymentHystrixService;</span><br><span class="line">import com.netflix.hystrix.contrib.javanica.annotation.DefaultProperties;</span><br><span class="line">import com.netflix.hystrix.contrib.javanica.annotation.HystrixCommand;</span><br><span class="line">import com.netflix.hystrix.contrib.javanica.annotation.HystrixProperty;</span><br><span class="line">import lombok.extern.slf4j.Slf4j;</span><br><span class="line">import org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line">import org.springframework.web.bind.annotation.PathVariable;</span><br><span class="line">import org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line">import javax.annotation.Resource;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * @program: cloud2020</span><br><span class="line"> * @description: kongzhiceng</span><br><span class="line"> * @author: Mr.Wang</span><br><span class="line"> * @create: 2020-08-20-22-42</span><br><span class="line"> *&#x2F;</span><br><span class="line">@RestController</span><br><span class="line">@Slf4j</span><br><span class="line">@DefaultProperties(defaultFallback &#x3D; &quot;payment_Global_FallbaxkMethod&quot;)</span><br><span class="line">public class PaymentHystirxController &#123;</span><br><span class="line"></span><br><span class="line">    @Resource</span><br><span class="line">    private PaymentHystrixService paymentHystrixService;</span><br><span class="line"></span><br><span class="line">    @GetMapping(&quot;&#x2F;consumer&#x2F;payment&#x2F;hystrix&#x2F;ok&#x2F;&#123;id&#125;&quot;)</span><br><span class="line">    public String paymentInfo_ok(@PathVariable(&quot;id&quot;) Integer id)&#123;</span><br><span class="line">        return paymentHystrixService.paymentInfo_ok(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;*@HystrixCommand(fallbackMethod &#x3D; &quot;paymentTimeoutFallcackMethod&quot;,commandProperties  &#x3D;&#123;</span><br><span class="line">           @HystrixProperty(name &#x3D; &quot;execution.isolation.thread.timeoutInMilliseconds&quot;,value &#x3D; &quot;1500&quot;)</span><br><span class="line">    &#125;)*&#x2F;</span><br><span class="line">    @HystrixCommand</span><br><span class="line">    @GetMapping(&quot;&#x2F;consumer&#x2F;payment&#x2F;hystrix&#x2F;timeout&#x2F;&#123;id&#125;&quot;)</span><br><span class="line">    public String paymentInfo_timeout(@PathVariable(&quot;id&quot;) Integer id)&#123;</span><br><span class="line">        return paymentHystrixService.paymentInfo_timeout(id);</span><br><span class="line">    &#125;</span><br><span class="line">    public String paymentTimeoutFallcackMethod(@PathVariable(&quot;id&quot;) Integer id)&#123;</span><br><span class="line">        return &quot;消费者客户端80的服务报错了&quot;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F;下面这个是全局的fallback方法</span><br><span class="line">    public String payment_Global_FallbaxkMethod()&#123;</span><br><span class="line">        return &quot;Global异常处理信息，请稍后再是....&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>  <img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ghy9xa99clj31fw0u0b2c.jpg" alt=""></p>
</li>
</ul>
</li>
<li><p>和业务逻辑混在一起？？？混乱</p>
<ul>
<li><p>服务降级，客户端去调用服务端，碰上服务端宕机或关闭</p>
</li>
<li><p>本次案例服务降级处理是在客户端80实现完成的，与服务端8001没有关系，只需要为Feign客户端定义的接口添加一个服务降级处理的实现类即可实现解耦</p>
</li>
<li><p>未来我们要面对的异常:运行、超时、宕机</p>
</li>
<li><p>再看我们的业务类PaymentController</p>
</li>
<li><p>修改cloud-consumer-feign-hystrix-order80</p>
</li>
<li><p>根据cloud-consumer-feign-hystrix-order80已经有的PaymentHystrixService接口，重新新建一个类（PaymentFallbackService）实现该接口，统一为接口里面的方法进行异常处理</p>
</li>
<li><p>PaymentFallbackService类实现PaymentFeignClientService接口</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">    package com.atguigu.springcloud.service;</span><br><span class="line">    </span><br><span class="line">    import org.springframework.stereotype.Component;</span><br><span class="line">    </span><br><span class="line">    @Component</span><br><span class="line">    public class PaymentFallbackHystrixService implements PaymentHystrixService&#123;</span><br><span class="line">        @Override</span><br><span class="line">        public String paymentInfo_ok(Integer id) &#123;</span><br><span class="line">            return &quot;------PaymentFallbackHystrixService-------&quot;;</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">        @Override</span><br><span class="line">        public String paymentInfo_timeout(Integer id) &#123;</span><br><span class="line">            return &quot;-----PaymentFallbackHystrixService---超时-----&quot;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    &#96;&#96;&#96;  </span><br><span class="line"></span><br><span class="line">* YML</span><br></pre></td></tr></table></figure>
<p>  feign:</p>
<pre><code>hystrix:
  enabled: true  #如果处理自身的容错就开启。开启方式与生产端不一样。</code></pre>  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">* PaymentFeignClientService接口</span><br></pre></td></tr></table></figure>
<pre><code>package com.atguigu.springcloud.service;

import org.springframework.cloud.openfeign.FeignClient;
import org.springframework.stereotype.Component;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PathVariable;

/**
 * @program: cloud2020
 * @description: 服务类
 * @author: Mr.Wang
 * @create: 2020-08-20-22-29
 */
@Component
@FeignClient(name = &quot;CLOUD-PROVIDER-HYSTRIX-PAYMENT&quot; ,fallback = PaymentFallbackHystrixService.class)
public interface PaymentHystrixService {

    @GetMapping(&quot;/payment/hystrix/ok/{id}&quot;)
    public String paymentInfo_ok(@PathVariable(&quot;id&quot;) Integer id);
    @GetMapping(&quot;/payment/hystrix/timeout/{id}&quot;)
    public String paymentInfo_timeout(@PathVariable(&quot;id&quot;) Integer id);
}
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">            ![](https:&#x2F;&#x2F;tva1.sinaimg.cn&#x2F;large&#x2F;007S8ZIlly1ghyds9vj9zj31js0mqqv5.jpg)</span><br><span class="line">    * 测试</span><br><span class="line">        * 单个eureka先启动7001</span><br><span class="line">        * PaymentHystrixMain8001启动</span><br><span class="line">        * 正常访问测试：http:&#x2F;&#x2F;localhost&#x2F;consumer&#x2F;payment&#x2F;hystrix&#x2F;ok&#x2F;31</span><br><span class="line">        * 故意关闭微服务8001</span><br><span class="line">        * 客户端自己调用提升：此时服务端provider已经down了，但是我们做了服务降级处理，让客户端在服务端不可用时也会获得提示信息而不会挂起耗死服务器</span><br><span class="line"></span><br><span class="line">#### 7.3.2 服务熔断</span><br><span class="line">1. 断路器</span><br><span class="line">一句话就是家里的保险丝</span><br><span class="line">2. 熔断是什么</span><br><span class="line">https:&#x2F;&#x2F;martinfowler.com&#x2F;bliki&#x2F;CircuitBreaker.html</span><br><span class="line">类比保险丝，达到最大访问后直接拒绝访问，拉闸限电，然后调用服务降级。当检测&#x3D;&#x3D;到该节点微服务调用正常后，恢复调用链路。&#x3D;&#x3D;</span><br><span class="line">当失败的调用达到一定阈值，缺省是5s内20次调用失败，就会启动熔断机制。熔断机制的注解是，@HystrixCommand</span><br><span class="line">3. 实操</span><br><span class="line">    * 修改cloud-provider-hystrix-payment8001</span><br><span class="line">    * PaymentService(为什么配置这些参数)</span><br></pre></td></tr></table></figure></code></pre><p>   /**</p>
<pre><code> * 服务熔断
 */
@HystrixCommand(fallbackMethod = &quot;paymentCircuitBreaker_fallback&quot;,commandProperties = {
        @HystrixProperty(name=&quot;circuitBreaker.enabled&quot;,value = &quot;true&quot;),//是否开启断路器
        @HystrixProperty(name=&quot;circuitBreaker.requestVolumeThreshold&quot;,value = &quot;10&quot;),//请求次数
        @HystrixProperty(name=&quot;circuitBreaker.sleepWindowInMilliseconds&quot;,value = &quot;10000&quot;),//时间范围
        @HystrixProperty(name=&quot;circuitBreaker.errorThresholdPercentage&quot;,value = &quot;60&quot;),//失败率达到多少次后跳闸
})
//// 加起来就是在10s内的10次请求中如果失败超过6次进入服务熔断
public String paymentCircuitBreaker(@PathVariable(&quot;id&quot;) Integer id){
    if(id &lt; 0){
        throw new RuntimeException(&quot;*****id 不能为负数&quot;);
    }
    String serialNumber = IdUtil.simpleUUID();
    return Thread.currentThread().getName()+&quot; \t 调用成功，流水号&quot;+serialNumber;
}
public String paymentCircuitBreaker_fallback(@PathVariable(&quot;id&quot;) Integer id){
    return &quot;id不能为附属，请稍后在是&quot;;
}</code></pre>  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"> </span><br></pre></td></tr></table></figure>
<p>  @GetMapping(“/payment/circuit/{id}”)</p>
<pre><code>public String paumentCircuitBreaker(@PathVariable(&quot;id&quot;) Integer id){
    String result = paymentService.paymentCircuitBreaker(id);
    log.info(&quot;*****info&quot;+result);
    return result;
}</code></pre>  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">    * 测试</span><br><span class="line">        * 自测cloud-provider-hystrix-payment8001</span><br><span class="line">        * 正确：http:&#x2F;&#x2F;localhost:8001&#x2F;payment&#x2F;circuit&#x2F;31</span><br><span class="line">        * 错误：http:&#x2F;&#x2F;localhost:8001&#x2F;payment&#x2F;circuit&#x2F;-31</span><br><span class="line">        * 一次正确一次错误trytry</span><br><span class="line">        * 重点测试:多次错误,然后慢慢正确，发现刚开始不满足条件，就算是正确的访问地址也不能进行访问，需要慢慢的恢复链路</span><br><span class="line">        * 结果：一直输入id为负数，达到失败率后即使输入id为正数也进入错误页面。</span><br><span class="line">4. 原理(小结)</span><br><span class="line">    * 断路器在什么情况下开始起作用</span><br><span class="line">    ![](https:&#x2F;&#x2F;tva1.sinaimg.cn&#x2F;large&#x2F;007S8ZIlly1ghyfe2vjddj318s0k6tup.jpg)</span><br><span class="line">    设计三个参数：时间窗，请求总阈值，错误百分比阈值</span><br><span class="line"></span><br><span class="line">    1. 快照时间窗：默认为最近的10s</span><br><span class="line">    2. 请求总数阈值：必须满足请求总阈值才有资格熔断。默认为20。意味着在10s内，如果命令调用次数不足20次，即使所有请求都超时或其他原因失败断路器都不会打开</span><br><span class="line">    3. 错误百分比阈值：在快照时间窗内请求总数超过阈值，且错误次数占总请求次数的比值大于阈值，断路器将会打开</span><br><span class="line">    * 断路器开启或者关闭的条件</span><br><span class="line">        * 当满足一定阀值的时候（默认10秒内超过20个请求次数）</span><br><span class="line">        * 当失败率达到一定的时候（默认10秒内超过50%请求失败）</span><br><span class="line">        * 到达以上阀值，断路器将会开启</span><br><span class="line">        * 当开启的时候，所有请求都不会进行转发</span><br><span class="line">        * 一段时间之后（默认是5秒），这个时候断路器是半开状态，会让其中一个请求进行转发。如果成功，断路器会关闭，若失败，继续开启。重复4和5</span><br><span class="line">    * 断路器打开之后</span><br><span class="line">    ![](https:&#x2F;&#x2F;tva1.sinaimg.cn&#x2F;large&#x2F;007S8ZIlly1ghyfh27eksj31980cg145.jpg)</span><br><span class="line">    * all配置:详细的看官网</span><br><span class="line"></span><br><span class="line">#### 7.3.3 服务限流</span><br><span class="line">后面高级篇讲解alibaba的Sentinel说明</span><br><span class="line">### 7.4 hystrix工作流程</span><br><span class="line">https:&#x2F;&#x2F;github.com&#x2F;Netflix&#x2F;Hystrix&#x2F;wiki&#x2F;How-it-Works</span><br><span class="line">### 7.5 服务监控hystrixDashboard</span><br><span class="line">* 概述</span><br><span class="line">* 仪表盘9001</span><br><span class="line">    * 新建cloud-consumer-hystrix-dashboard9001</span><br><span class="line">    ![](https:&#x2F;&#x2F;tva1.sinaimg.cn&#x2F;large&#x2F;007S8ZIlly1ghygoe9t00j319m08a111.jpg)</span><br><span class="line">    * POM</span><br></pre></td></tr></table></figure>
  <?xml version="1.0" encoding="UTF-8"?>
<p>  &lt;project xmlns=”<a href="http://maven.apache.org/POM/4.0.0&quot;" target="_blank" rel="noopener">http://maven.apache.org/POM/4.0.0&quot;</a></p>
<pre><code>     xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
     xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;
&lt;parent&gt;
    &lt;artifactId&gt;cloud2020&lt;/artifactId&gt;
    &lt;groupId&gt;com.atguigu.springcloud&lt;/groupId&gt;
    &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;
&lt;/parent&gt;
&lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;

&lt;artifactId&gt;cloud-consumer-hystrix-dashboard9001&lt;/artifactId&gt;

&lt;dependencies&gt;
    &lt;!--新增hystrix dashboard--&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
        &lt;artifactId&gt;spring-cloud-starter-netflix-hystrix-dashboard&lt;/artifactId&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt;
        &lt;scope&gt;runtime&lt;/scope&gt;
        &lt;optional&gt;true&lt;/optional&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;
        &lt;artifactId&gt;lombok&lt;/artifactId&gt;
        &lt;optional&gt;true&lt;/optional&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;
        &lt;scope&gt;test&lt;/scope&gt;
    &lt;/dependency&gt;
&lt;/dependencies&gt;</code></pre>  </project>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">* YML</span><br><span class="line">&#96;server.port:9001&#96;</span><br><span class="line">* HystrixDashboardMain9001+新注解@EnableHystrixDashboard</span><br></pre></td></tr></table></figure>
  package com.atguigu.springcloud;

<p>  import org.springframework.boot.SpringApplication;<br>  import org.springframework.boot.autoconfigure.SpringBootApplication;<br>  import org.springframework.cloud.netflix.hystrix.dashboard.EnableHystrixDashboard;</p>
<p>  /**</p>
<ul>
<li><p>@program: cloud2020</p>
</li>
<li><p>@description: qidonglei</p>
</li>
<li><p>@author: Mr.Wang</p>
</li>
<li><p>@create: 2020-08-21-15-37</p>
</li>
<li><p>/<br>@SpringBootApplication<br>@EnableHystrixDashboard<br>public class HystrixDashboardMain9001 {<br>  public static void main(String[] args) {</p>
<pre><code>SpringApplication.run(HystrixDashboardMain9001.class,args);</code></pre><p>  }<br>}</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">    * 所有Provider微服务提供类（8001&#x2F;8002&#x2F;8003）都需要监控依赖配</span><br><span class="line">    * 启动cloud-consumer-hystrix-dashboard9001该微服务后续将监控微服务8001</span><br><span class="line">        http:&#x2F;&#x2F;localhost:9001&#x2F;hystrix</span><br><span class="line">* 断路器演示</span><br><span class="line">    * 修改cloud-provider-hystrix-payment8001</span><br><span class="line">    注意：新版本Hystrix需要在主启动类MainAppHystrix8001中指定监控路径</span><br><span class="line">    Unable to connect to Command Metric Stream</span><br><span class="line">    404</span><br></pre></td></tr></table></figure>
<p>@Bean<br>  public ServletRegistrationBean getServlet(){</p>
<pre><code>HystrixMetricsStreamServlet streamServlet = new HystrixMetricsStreamServlet();
ServletRegistrationBean registrationBean = new ServletRegistrationBean(streamServlet);
registrationBean.setLoadOnStartup(1);
registrationBean.addUrlMappings(&quot;/hystrix.stream&quot;);
registrationBean.setName(&quot;HystrixMetricsStreamServlet&quot;);
return registrationBean;</code></pre><p>  }</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">    * 监控测试</span><br><span class="line">        1. 启动1个eureka或者3个eureka集群均可</span><br><span class="line">        2. 观察监控窗口</span><br><span class="line">            * 9001监控8001:填写监控地址：http:&#x2F;&#x2F;localhost:8001&#x2F;hystrix.stream</span><br><span class="line">            ![](https:&#x2F;&#x2F;tva1.sinaimg.cn&#x2F;large&#x2F;007S8ZIlly1ghyhmfgdejj31pw0u0nau.jpg)</span><br><span class="line">            * 测试地址</span><br><span class="line">                * http:&#x2F;&#x2F;localhost:8001&#x2F;payment&#x2F;circuit&#x2F;31，http:&#x2F;&#x2F;localhost:8001&#x2F;payment&#x2F;circuit&#x2F;-31</span><br><span class="line">                * 结果：测试通过</span><br><span class="line">                * 先访问正确地址，再访问错误地址，再正确地址，会发现图示断路器都是慢慢放开的：先是成功后是失败</span><br><span class="line">            * 如何看</span><br><span class="line">                * 7色</span><br><span class="line">               ![](https:&#x2F;&#x2F;tva1.sinaimg.cn&#x2F;large&#x2F;007S8ZIlly1ghyhwhmruej31de0pqal6.jpg)</span><br><span class="line">                * 1圈</span><br><span class="line">                ![](https:&#x2F;&#x2F;tva1.sinaimg.cn&#x2F;large&#x2F;007S8ZIlly1ghyhx2vfjnj319q08c7au.jpg)</span><br><span class="line">                * 1线：访问趋势</span><br><span class="line">                * 整图说明</span><br><span class="line">                ![](https:&#x2F;&#x2F;tva1.sinaimg.cn&#x2F;large&#x2F;007S8ZIlly1ghyhxzb7d0j31900ji16m.jpg)</span><br><span class="line">                * 正图说明2</span><br><span class="line">                    ![](https:&#x2F;&#x2F;tva1.sinaimg.cn&#x2F;large&#x2F;007S8ZIlly1ghyhygi7zvj31aa0imk9g.jpg)</span><br><span class="line">            * 搞懂一个才能看懂复杂的</span><br><span class="line"></span><br><span class="line">            </span><br><span class="line">## 8. zuul路由网关（没讲）</span><br><span class="line">## 9. Gateway新一代网关</span><br><span class="line">### 9.1 概述简介</span><br><span class="line">1. 官网</span><br><span class="line">    * 上一代zuul 1.x:https:&#x2F;&#x2F;github.com&#x2F;Netflix&#x2F;zuul&#x2F;wiki</span><br><span class="line">    * 当前gateway:https:&#x2F;&#x2F;cloud.spring.io&#x2F;spring-cloud-static&#x2F;spring-cloud-gateway&#x2F;2.2.1.RELEASE&#x2F;reference&#x2F;html&#x2F;</span><br><span class="line">2. 是什么</span><br><span class="line">Spring Cloud Gateway 使用的Webflux中的reactor-netty响应式编程组件，底层使用了Netty通讯框架</span><br><span class="line">3. 能干嘛</span><br><span class="line">    * 反向代理</span><br><span class="line">    * 鉴权</span><br><span class="line">    * 流量控制</span><br><span class="line">    * 熔断</span><br><span class="line">    * 日志监控</span><br><span class="line">4. 微服务架构中网关在哪里</span><br><span class="line">![](https:&#x2F;&#x2F;tva1.sinaimg.cn&#x2F;large&#x2F;007S8ZIlly1gi1nmie3cwj31560jigrc.jpg)</span><br><span class="line">![](https:&#x2F;&#x2F;tva1.sinaimg.cn&#x2F;large&#x2F;007S8ZIlly1gi1nn2t1rhj30qm0ibqcq.jpg)</span><br><span class="line">5. 有了zuul怎么又出来gateway</span><br><span class="line">spring cloud gateway具有如下的特性</span><br><span class="line">    * 基于Spring Framework5 ,Project Reactor和Spring boot 2.0进行构建的</span><br><span class="line">    * 动态路由：能够匹配任何请求属性</span><br><span class="line">    * 可以对路由指定Preidcate(断言)和Filter(过滤器)</span><br><span class="line">    * 集成Hystrix的断路器功能</span><br><span class="line">    * 集成Spring Cloud 服务发现功能</span><br><span class="line">    * 易于编写的Predicate(断言)和Filter(过滤器)</span><br><span class="line">    * 请求限流功能</span><br><span class="line">    * 支持路径重写</span><br><span class="line"></span><br><span class="line">### 9.2 三大核心概念</span><br><span class="line">1. Route(路由)</span><br><span class="line">路由是构建网关的基本模块，它由ID，目标URI，一系列的断言和过滤器组成，如果断言为true则匹配该路由</span><br><span class="line">2. Predicate(断言)</span><br><span class="line">参考的是java8的java.util.function.Predicate开发人员可以匹配HTTP请求中的所有内容（例如请求头或请求参数），如果请求与断言相匹配则进行路由</span><br><span class="line">3. Filter(过滤)</span><br><span class="line">指的是Spring框架中GatewayFilter的实例，使用过滤器，可以在请求被路由前或者之后对请求进行修改。</span><br><span class="line">4. 总体</span><br><span class="line">web请求，通过一些匹配条件，定位到真正的服务节点。并在这个转发过程的前后进行一些精细化控制。predicate就是我们的匹配条件；而filter，就可以理解为一个无所不能的拦截器，有了这两个元素，在加上目标uri就可以实现一个具体的路由了</span><br><span class="line">### 9.3 Gateway工作流程</span><br><span class="line">客户端向Spring Cloud Gateway发出请求。如果网关处理程序映射确定请求与路由匹配，则将其发送到网关Web处理程序。该处理程序通过特定于请求的过滤器链来运行请求。筛选器由虚线分隔的原因是，筛选器可以在发送代理请求之前和之后运行逻辑。所有“前置”过滤器逻辑均被执行。然后发出代理请求。发出代理请求后，将运行“后”过滤器逻辑。</span><br><span class="line">![](https:&#x2F;&#x2F;tva1.sinaimg.cn&#x2F;large&#x2F;007S8ZIlly1gi1ob6owtrj30cb0gjdfw.jpg)</span><br><span class="line"></span><br><span class="line">### 9.4 入门配置</span><br><span class="line">1. 新建module:&#96;cloud-gateway-gateway9527&#96;</span><br><span class="line">2. POM文件</span><br></pre></td></tr></table></figure>
<?xml version="1.0" encoding="UTF-8"?>
<p><project xmlns="http://maven.apache.org/POM/4.0.0"
   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
   xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"></p>
<parent>
  <artifactId>cloud2020</artifactId>
  <groupId>com.atguigu.springcloud</groupId>
  <version>1.0-SNAPSHOT</version>
</parent>
<modelVersion>4.0.0</modelVersion>

<p><artifactId>cloud-gateway-gateway9527</artifactId></p>
<dependencies>
  <!--新增gateway-->
  <dependency>
      <groupId>org.springframework.cloud</groupId>
      <artifactId>spring-cloud-starter-gateway</artifactId>
  </dependency>
  <dependency>
      <groupId>com.atguigu.springcloud</groupId>
      <artifactId>cloud-api-commons</artifactId>
      <version>1.0-SNAPSHOT</version>
  </dependency>
  <dependency>
      <groupId>org.springframework.cloud</groupId>
      <artifactId>spring-cloud-starter-netflix-hystrix</artifactId>
  </dependency>
  <dependency>
      <groupId>org.springframework.cloud</groupId>
      <artifactId>spring-cloud-starter-netflix-eureka-client</artifactId>
  </dependency>
  <dependency>
      <groupId>org.springframework.boot</groupId>
      <artifactId>spring-boot-devtools</artifactId>
      <scope>runtime</scope>
      <optional>true</optional>
  </dependency>
  <dependency>
      <groupId>org.projectlombok</groupId>
      <artifactId>lombok</artifactId>
      <optional>true</optional>
  </dependency>
  <dependency>
      <groupId>org.springframework.boot</groupId>
      <artifactId>spring-boot-starter-test</artifactId>
      <scope>test</scope>
  </dependency>
</dependencies>

</li>
</ul>
</project>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">    ![](https:&#x2F;&#x2F;tva1.sinaimg.cn&#x2F;large&#x2F;007S8ZIlly1gib5uwic7wj31cs0u07wj.jpg)</span><br><span class="line">3. YML配置</span><br></pre></td></tr></table></figure>
server:
port: 9527

<p>spring:<br>application:<br>  name: cloud-gateway<br>eureka:<br>instance:<br>  hostname: cloud-gateway-service<br>client:<br>  service-url:</p>
<pre><code>register-with-eureka: true
fetch-registry: true
defaultZone: http://localhost:7001/eureka</code></pre><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1. 业务类:无</span><br><span class="line">2. 主启动类：同前几个步骤中的主启动类</span><br><span class="line">3. 9527网关如何做路由映射</span><br><span class="line">    * cloud-provider-payment8001看看controller的访问地址:get&#x2F;lib</span><br><span class="line">    * 我们目前不想暴露8001端口，希望在8001外面套一层9527</span><br><span class="line">4. YML新增网关配置</span><br></pre></td></tr></table></figure>
<p>server:<br>port: 9527</p>
<p>spring:<br>application:<br>  name: cloud-gateway<br>cloud:<br>  gateway:</p>
<pre><code>routes:
  - id: payment_routh # 路由的ID没有固定规则，但是要求统一，建议配合服务名
    uri: http://localhost:8001 #匹配后提供服务的路由地址
    predicates:
      - Path=/payment/get/** #断言，路由匹配进行路由
  - id: payment_routh2
    uri: http://localhost:8001
    predicates:
      - Path=/payment/lb/**</code></pre><p>eureka:<br>instance:<br>  hostname: cloud-gateway-service<br>client:<br>  service-url:</p>
<pre><code>register-with-eureka: true
fetch-registry: true
defaultZone: http://localhost:7001/eureka</code></pre><p>```<br><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gib5z5mab2j315z0u07wj.jpg" alt=""></p>
</li>
</ul>
</li>
<li><p>测试</p>
<ul>
<li>启动7001</li>
<li>启动8001:<code>cloud-provider-payment8001</code></li>
<li>启动9527网关</li>
<li>访问说明<ul>
<li>添加网关前:<a href="http://localhost:8001/payment/get/31" target="_blank" rel="noopener">http://localhost:8001/payment/get/31</a></li>
<li>添加网关后:<a href="http://localhost:9527/payment/get/31" target="_blank" rel="noopener">http://localhost:9527/payment/get/31</a></li>
</ul>
</li>
</ul>
</li>
<li><p>YML配置说明-gateway网关路由两种配置方式</p>
<ul>
<li>在yml文件中的配置<br>  <img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gib6j3wn7cj31ey0osdzr.jpg" alt=""></li>
<li>代码中注入<code>RouteLocator</code>的Bean<ul>
<li>官网案例<br><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gib6pq9zqfj30n60ey43r.jpg" alt=""></li>
<li><a href="http://news.baidu.com/guoji" target="_blank" rel="noopener">百度国内新闻网址，需要外网</a></li>
<li>自己写一个<ul>
<li>百度新闻</li>
<li>业务需求:通过9527网关访问到外网的百度新闻地址</li>
<li>编码<br>1）cloud-gateway-gateway9527<br>2) 业务实现</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ol>
<h3 id="9-5-通过微服务名实现动态路由"><a href="#9-5-通过微服务名实现动态路由" class="headerlink" title="9.5 通过微服务名实现动态路由"></a>9.5 通过微服务名实现动态路由</h3><h3 id="9-6-Predicate的使用"><a href="#9-6-Predicate的使用" class="headerlink" title="9.6 Predicate的使用"></a>9.6 Predicate的使用</h3><h3 id="9-7-Filter的使用"><a href="#9-7-Filter的使用" class="headerlink" title="9.7 Filter的使用"></a>9.7 Filter的使用</h3><h2 id="10-SpringCloud-config分布式配置中心"><a href="#10-SpringCloud-config分布式配置中心" class="headerlink" title="10. SpringCloud config分布式配置中心"></a>10. SpringCloud config分布式配置中心</h2><h3 id="10-1-概述"><a href="#10-1-概述" class="headerlink" title="10.1 概述"></a>10.1 概述</h3><h3 id="10-2-Config服务端配置与测试"><a href="#10-2-Config服务端配置与测试" class="headerlink" title="10.2 Config服务端配置与测试"></a>10.2 Config服务端配置与测试</h3><h3 id="10-3-Config客户端配置与测试"><a href="#10-3-Config客户端配置与测试" class="headerlink" title="10.3 Config客户端配置与测试"></a>10.3 Config客户端配置与测试</h3><h3 id="10-4-Config客户端之动态刷新"><a href="#10-4-Config客户端之动态刷新" class="headerlink" title="10.4 Config客户端之动态刷新"></a>10.4 Config客户端之动态刷新</h3><h2 id="11-SpringCloud-Bus-消息总线"><a href="#11-SpringCloud-Bus-消息总线" class="headerlink" title="11. SpringCloud Bus 消息总线"></a>11. SpringCloud Bus 消息总线</h2><h3 id="11-1-概述"><a href="#11-1-概述" class="headerlink" title="11.1 概述"></a>11.1 概述</h3><h3 id="11-2-RabbitMQ环境配置"><a href="#11-2-RabbitMQ环境配置" class="headerlink" title="11.2 RabbitMQ环境配置"></a>11.2 RabbitMQ环境配置</h3><h3 id="11-3-SpringCloud-Bus动态刷新全局广播"><a href="#11-3-SpringCloud-Bus动态刷新全局广播" class="headerlink" title="11.3 SpringCloud Bus动态刷新全局广播"></a>11.3 SpringCloud Bus动态刷新全局广播</h3><h3 id="11-4-SpringCloud-Bus动态刷新定点通知"><a href="#11-4-SpringCloud-Bus动态刷新定点通知" class="headerlink" title="11.4 SpringCloud Bus动态刷新定点通知"></a>11.4 SpringCloud Bus动态刷新定点通知</h3><h2 id="12-SpringCloud-Stream消息驱动"><a href="#12-SpringCloud-Stream消息驱动" class="headerlink" title="12. SpringCloud Stream消息驱动"></a>12. SpringCloud Stream消息驱动</h2><h3 id="12-1-消息驱动概述"><a href="#12-1-消息驱动概述" class="headerlink" title="12.1 消息驱动概述"></a>12.1 消息驱动概述</h3><h3 id="12-2-案例说明"><a href="#12-2-案例说明" class="headerlink" title="12.2 案例说明"></a>12.2 案例说明</h3><h3 id="12-3-消息驱动之生产者"><a href="#12-3-消息驱动之生产者" class="headerlink" title="12.3 消息驱动之生产者"></a>12.3 消息驱动之生产者</h3><h3 id="12-4-消息驱动之消费者"><a href="#12-4-消息驱动之消费者" class="headerlink" title="12.4 消息驱动之消费者"></a>12.4 消息驱动之消费者</h3><h3 id="12-5-分组消费与持久化"><a href="#12-5-分组消费与持久化" class="headerlink" title="12.5 分组消费与持久化"></a>12.5 分组消费与持久化</h3><h2 id="13-SpringCloud-Sleuth分布式请求链路追踪"><a href="#13-SpringCloud-Sleuth分布式请求链路追踪" class="headerlink" title="13. SpringCloud Sleuth分布式请求链路追踪"></a>13. SpringCloud Sleuth分布式请求链路追踪</h2><h3 id="13-1-概述"><a href="#13-1-概述" class="headerlink" title="13.1 概述"></a>13.1 概述</h3><h3 id="13-2-搭建链路监控步骤"><a href="#13-2-搭建链路监控步骤" class="headerlink" title="13.2 搭建链路监控步骤"></a>13.2 搭建链路监控步骤</h3><h2 id="14-SpringCloud-Alibaba入门简介"><a href="#14-SpringCloud-Alibaba入门简介" class="headerlink" title="14. SpringCloud Alibaba入门简介"></a>14. SpringCloud Alibaba入门简介</h2><h3 id="14-1-why会出现SpringCloud-alibaba"><a href="#14-1-why会出现SpringCloud-alibaba" class="headerlink" title="14.1 why会出现SpringCloud alibaba"></a>14.1 why会出现SpringCloud alibaba</h3><h3 id="14-2-SpringCloud-alibaba带来了什么？"><a href="#14-2-SpringCloud-alibaba带来了什么？" class="headerlink" title="14.2 SpringCloud alibaba带来了什么？"></a>14.2 SpringCloud alibaba带来了什么？</h3><h3 id="14-3-SpringCloud-alibaba学习资料获取"><a href="#14-3-SpringCloud-alibaba学习资料获取" class="headerlink" title="14.3 SpringCloud alibaba学习资料获取"></a>14.3 SpringCloud alibaba学习资料获取</h3><h2 id="15-SpringCloud-Alibaba-Nacos服务注册和配置中心"><a href="#15-SpringCloud-Alibaba-Nacos服务注册和配置中心" class="headerlink" title="15. SpringCloud Alibaba Nacos服务注册和配置中心"></a>15. SpringCloud Alibaba Nacos服务注册和配置中心</h2><h3 id="15-1-Nacos简介"><a href="#15-1-Nacos简介" class="headerlink" title="15.1 Nacos简介"></a>15.1 Nacos简介</h3><h3 id="15-2-安装并运行Nacos"><a href="#15-2-安装并运行Nacos" class="headerlink" title="15.2 安装并运行Nacos"></a>15.2 安装并运行Nacos</h3><h3 id="15-3-Nacos作为服务注册中心演示"><a href="#15-3-Nacos作为服务注册中心演示" class="headerlink" title="15.3 Nacos作为服务注册中心演示"></a>15.3 Nacos作为服务注册中心演示</h3><h3 id="15-4-Nacos作为服务配置中心演示"><a href="#15-4-Nacos作为服务配置中心演示" class="headerlink" title="15.4 Nacos作为服务配置中心演示"></a>15.4 Nacos作为服务配置中心演示</h3><h3 id="15-5-Nacos集群和持久化配置（重要）"><a href="#15-5-Nacos集群和持久化配置（重要）" class="headerlink" title="15.5 Nacos集群和持久化配置（重要）"></a>15.5 Nacos集群和持久化配置（重要）</h3><h2 id="16-SpringCloud-Alibaba-Sentinel实现熔断与限流"><a href="#16-SpringCloud-Alibaba-Sentinel实现熔断与限流" class="headerlink" title="16. SpringCloud Alibaba Sentinel实现熔断与限流"></a>16. SpringCloud Alibaba Sentinel实现熔断与限流</h2><h3 id="16-1-Sentinel"><a href="#16-1-Sentinel" class="headerlink" title="16.1 Sentinel"></a>16.1 Sentinel</h3><h3 id="16-2-安装Sentinel控制台"><a href="#16-2-安装Sentinel控制台" class="headerlink" title="16.2 安装Sentinel控制台"></a>16.2 安装Sentinel控制台</h3><h3 id="16-3-初始化演示工程"><a href="#16-3-初始化演示工程" class="headerlink" title="16.3 初始化演示工程"></a>16.3 初始化演示工程</h3><h3 id="16-4-流控规则"><a href="#16-4-流控规则" class="headerlink" title="16.4 流控规则"></a>16.4 流控规则</h3><h3 id="16-5-降级规则"><a href="#16-5-降级规则" class="headerlink" title="16.5 降级规则"></a>16.5 降级规则</h3><h3 id="16-6-热点key限流"><a href="#16-6-热点key限流" class="headerlink" title="16.6 热点key限流"></a>16.6 热点key限流</h3><h3 id="16-7-系统规则"><a href="#16-7-系统规则" class="headerlink" title="16.7 系统规则"></a>16.7 系统规则</h3><h3 id="16-8-SentinelResource"><a href="#16-8-SentinelResource" class="headerlink" title="16.8 @SentinelResource"></a>16.8 @SentinelResource</h3><h3 id="16-9-服务熔断功能"><a href="#16-9-服务熔断功能" class="headerlink" title="16.9 服务熔断功能"></a>16.9 服务熔断功能</h3><h3 id="16-10-规则持久化"><a href="#16-10-规则持久化" class="headerlink" title="16.10 规则持久化"></a>16.10 规则持久化</h3><h2 id="17-SpringCloud-Alibaba-Seata处理分布式事务"><a href="#17-SpringCloud-Alibaba-Seata处理分布式事务" class="headerlink" title="17. SpringCloud Alibaba Seata处理分布式事务"></a>17. SpringCloud Alibaba Seata处理分布式事务</h2><h3 id="17-1-分布式事务问题"><a href="#17-1-分布式事务问题" class="headerlink" title="17.1 分布式事务问题"></a>17.1 分布式事务问题</h3><h3 id="17-2-Seata简介"><a href="#17-2-Seata简介" class="headerlink" title="17.2 Seata简介"></a>17.2 Seata简介</h3><h3 id="17-3-Seata-Server安装"><a href="#17-3-Seata-Server安装" class="headerlink" title="17.3 Seata-Server安装"></a>17.3 Seata-Server安装</h3><h3 id="17-4-订单-库存-账户业务数据库准备"><a href="#17-4-订单-库存-账户业务数据库准备" class="headerlink" title="17.4 订单/库存/账户业务数据库准备"></a>17.4 订单/库存/账户业务数据库准备</h3><h3 id="17-5-订单-库存-账户业务微服务准备"><a href="#17-5-订单-库存-账户业务微服务准备" class="headerlink" title="17.5 订单/库存/账户业务微服务准备"></a>17.5 订单/库存/账户业务微服务准备</h3><h3 id="17-6-Test"><a href="#17-6-Test" class="headerlink" title="17.6 Test"></a>17.6 Test</h3><h3 id="17-7-Seata之原理简介"><a href="#17-7-Seata之原理简介" class="headerlink" title="17.7 Seata之原理简介"></a>17.7 Seata之原理简介</h3>
      
    </div>
    <div class="article-footer">
      <!--每篇文章下的版权说明-->
<blockquote class="mt-2x">
  <ul class="post-copyright list-unstyled">
    
    <li class="post-copyright-link hidden-xs">
      <strong>本文链接：</strong>
      <a href="http://lwblog.xyz/posts/2e26b41f.html" title="Spring_Cloud笔记一" target="_blank" rel="external">http://lwblog.xyz/posts/2e26b41f.html</a>
    </li>
    
    <li class="post-copyright-license">
      <strong>版权声明： </strong> 本博客所有文章除特别声明外，均采用 <a href="http://creativecommons.org/licenses/by/4.0/deed.zh" target="_blank" rel="external">CC BY 4.0 CN协议</a> 许可协议。转载请注明出处！
    </li>
  </ul>
</blockquote>
<!--每篇文章最底部的个人信息说明-->


<div class="panel panel-default panel-badger">
  <div class="panel-body">
    <figure class="media">
      <div class="media-left">
        <a href="https://github.com/wangyufei123" target="_blank" class="img-burn thumb-sm visible-lg">
          <img src="/images/avatar.jpeg" class="img-rounded w-full" alt="">
        </a>
      </div>
      <div class="media-body">
        <h3 class="media-heading"><a href="https://github.com/wangyufei123" target="_blank"><span class="text-dark">Mr.Wang</span><small class="ml-1x">Web Developer &amp; Designer</small></a></h3>
        <div>一个热爱生活的小开发....</div>
      </div>
    </figure>
  </div>
</div>


    </div>
  </article>
  
    
  <section id="comments">
  	
      <div id="vcomments"></div>
    
  </section>


  
</div>

  <nav class="bar bar-footer clearfix" data-stick-bottom>
  <div class="bar-inner">
    <!--上一篇或者是下一篇的位置-->
  
  <ul class="pager pull-left">
    
    
    <li class="next">
      <a href="/posts/undefined.html" title="Centos7下静默安装Oracle 11g"><span>下一篇&nbsp;&nbsp;</span><i class="icon icon-angle-right" aria-hidden="true"></i></a>
    </li>
    
    
  </ul>
  
  
  <!--捐赠信息是否需要显示的图标-->
  <div class="bar-right">
    
    <div class="share-component" data-sites="weibo,qq,wechat,facebook,twitter" data-mobile-sites="weibo,qq,qzone"></div>
    
  </div>
  </div>
</nav>
  


</main>

  <footer class="footer" itemscope itemtype="http://schema.org/WPFooter">
	
	
    <ul class="social-links">
    	
        <li><a href="https://github.com/wangyufei123" target="_blank" title="Github" data-toggle=tooltip data-placement=top><i class="icon icon-github"></i></a></li>
        
        <li><a href="/atom.xml" target="_blank" title="Rss" data-toggle=tooltip data-placement=top><i class="icon icon-rss"></i></a></li>
        
    </ul>

	<!-- 侧边栏版权问题修改 -->
    <div class="copyright">
    	
        &copy; 2020 Mr.Wang
        
        <!-- 页面侧边栏脚标修改 -->
        <div class="publishby">
        	Theme by <a href="https://github.com/wangyufei123" target="_blank"> 随笔小记 </a>base on <a href="https://github.com/cofess/hexo-theme-pure" target="_blank">pure</a>.
        </div>
    </div>
</footer>
  <script src="//cdn.jsdelivr.net/npm/jquery@1.12.4/dist/jquery.min.js"></script>
<script>
window.jQuery || document.write('<script src="js/jquery.min.js"><\/script>')
</script>

<script src="/js/plugin.min.js"></script>


<script src="/js/application.js"></script>


    <script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: '文章',
            PAGES: '页面',
            CATEGORIES: '分类',
            TAGS: '标签',
            UNTITLED: '(未命名)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>

<script src="/js/insight.js"></script>






   
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>





   
    
  <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/valine"></script>
  <script type="text/javascript">
  var GUEST = ['nick', 'mail', 'link'];
  var meta = 'nick,mail,link';
  meta = meta.split(',').filter(function(item) {
    return GUEST.indexOf(item) > -1;
  });
  new Valine({
    el: '#vcomments',
    verify: false,
    notify: false,
    appId: 'a1SlXAotYrikeQEkob4dUwEO-gzGzoHsz',
    appKey: 'A9wmspkpn043w1kJDU9CEXgt',
    placeholder: 'Just go go',
    avatar: 'mm',
    meta: meta,
    pageSize: '10' || 10,
    visitor: false
  });
  </script>

     



  <script src="//cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.3.5/dist/jquery.fancybox.min.js"></script>
  <script>
  //利用 FancyBox 实现点击图片放大
  $(document).ready(function() {
    $('article img').not('[hidden]').not('.panel-body img').each(function() {
      var $image = $(this);
      var imageCaption = $image.attr('alt');
      var $imageWrapLink = $image.parent('a');
      if ($imageWrapLink.length < 1) {
        var src = this.getAttribute('src');
        var idx = src.lastIndexOf('?');
        if (idx != -1) {
          src = src.substring(0, idx);
        }
        $imageWrapLink = $image.wrap('<a href="' + src + '"></a>').parent('a');
      }
      $imageWrapLink.attr('data-fancybox', 'images');
      if (imageCaption) {
        $imageWrapLink.attr('data-caption', imageCaption);
      }
    });
    $().fancybox({
      selector: '[data-fancybox="images"]',
      hash: false,
      loop: false,
    });
  });
  </script>





</body>
<!--背景3D动画-->
<script type="text/javascript" src="//cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js"></script>
<!--点击出现小爱心-->
<script type="text/javascript" src="//cdn.jsdelivr.net/gh/ygbhf/clicklove/clicklove.js"></script>
<!-- 代码块复制功能 -->
<script src="https://cdn.jsdelivr.net/npm/clipboard@1/dist/clipboard.min.js"></script>
<script type="text/javascript" src="https://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>
<!-- <script type="text/javascript" src="/js/clipboard.js"></script>  -->
<script type="text/javascript" src="/js/clipboard_use.js"></script>
</html>